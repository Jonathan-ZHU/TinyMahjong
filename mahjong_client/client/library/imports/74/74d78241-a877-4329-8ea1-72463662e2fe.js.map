{"version":3,"sources":["assets/scripts/UserMgr.js"],"names":["cc","Class","extends","Component","properties","account","userId","userName","lv","exp","coins","gems","sign","ip","sex","roomData","oldRoomId","guestAuth","args","sys","localStorage","getItem","Date","now","setItem","vv","http","sendRequest","onAuth","ret","self","userMgr","errcode","console","log","errmsg","url","SI","hall","login","onLogin","userid","director","loadScene","name","roomid","wc","show","create","onCreate","data","enterRoom","roomId","callback","onEnter","setTimeout","hide","gameNetMgr","connectGameServer","getHistoryList","onGet","history","getGamesOfRoom","uuid","getDetailOfGame","index"],"mappings":";;;;;;AAAAA,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;AAELC,gBAAY;AACRC,iBAAQ,IADA;AAEXC,gBAAO,IAFI;AAGdC,kBAAS,IAHK;AAIdC,YAAG,CAJW;AAKdC,aAAI,CALU;AAMdC,eAAM,CANQ;AAOdC,cAAK,CAPS;AAQdC,cAAK,CARS;AASRC,YAAG,EATK;AAURC,aAAI,CAVI;AAWRC,kBAAS,IAXD;AAYRC,mBAAU;AAZF,KAFP;;AAiBLC,eAAU,qBAAU;AAChB,YAAIZ,UAAUL,GAAGkB,IAAH,CAAQ,SAAR,CAAd;AACA,YAAGb,WAAW,IAAd,EAAmB;AACfA,sBAAUL,GAAGmB,GAAH,CAAOC,YAAP,CAAoBC,OAApB,CAA4B,SAA5B,CAAV;AACH;;AAED,YAAGhB,WAAW,IAAd,EAAmB;AACfA,sBAAUiB,KAAKC,GAAL,EAAV;AACAvB,eAAGmB,GAAH,CAAOC,YAAP,CAAoBI,OAApB,CAA4B,SAA5B,EAAsCnB,OAAtC;AACH;;AAEDL,WAAGyB,EAAH,CAAMC,IAAN,CAAWC,WAAX,CAAuB,QAAvB,EAAgC,EAACtB,SAAQA,OAAT,EAAhC,EAAkD,KAAKuB,MAAvD;AACH,KA7BI;;AA+BLA,YAAO,gBAASC,GAAT,EAAa;AAChB,YAAIC,OAAO9B,GAAGyB,EAAH,CAAMM,OAAjB;AACA,YAAGF,IAAIG,OAAJ,KAAgB,CAAnB,EAAqB;AACjBC,oBAAQC,GAAR,CAAYL,IAAIM,MAAhB;AACH,SAFD,MAGI;AACAL,iBAAKzB,OAAL,GAAewB,IAAIxB,OAAnB;AACAyB,iBAAKlB,IAAL,GAAYiB,IAAIjB,IAAhB;AACAZ,eAAGyB,EAAH,CAAMC,IAAN,CAAWU,GAAX,GAAiB,YAAYpC,GAAGyB,EAAH,CAAMY,EAAN,CAASC,IAAtC;AACAR,iBAAKS,KAAL;AACH;AACJ,KA1CI;;AA4CLA,WAAM,iBAAU;AACZ,YAAIT,OAAO,IAAX;AACA,YAAIU,UAAU,SAAVA,OAAU,CAASX,GAAT,EAAa;AACvB,gBAAGA,IAAIG,OAAJ,KAAgB,CAAnB,EAAqB;AACjBC,wBAAQC,GAAR,CAAYL,IAAIM,MAAhB;AACH,aAFD,MAGI;AACA,oBAAG,CAACN,IAAIY,MAAR,EAAe;AACX;AACAzC,uBAAG0C,QAAH,CAAYC,SAAZ,CAAsB,YAAtB;AACH,iBAHD,MAII;AACAV,4BAAQC,GAAR,CAAYL,GAAZ;AACAC,yBAAKzB,OAAL,GAAewB,IAAIxB,OAAnB;AACTyB,yBAAKxB,MAAL,GAAcuB,IAAIY,MAAlB;AACAX,yBAAKvB,QAAL,GAAgBsB,IAAIe,IAApB;AACAd,yBAAKtB,EAAL,GAAUqB,IAAIrB,EAAd;AACAsB,yBAAKrB,GAAL,GAAWoB,IAAIpB,GAAf;AACAqB,yBAAKpB,KAAL,GAAamB,IAAInB,KAAjB;AACAoB,yBAAKnB,IAAL,GAAYkB,IAAIlB,IAAhB;AACSmB,yBAAKf,QAAL,GAAgBc,IAAIgB,MAApB;AACAf,yBAAKhB,GAAL,GAAWe,IAAIf,GAAf;AACAgB,yBAAKjB,EAAL,GAAUgB,IAAIhB,EAAd;AACTb,uBAAG0C,QAAH,CAAYC,SAAZ,CAAsB,MAAtB;AACM;AACJ;AACJ,SAxBD;AAyBA3C,WAAGyB,EAAH,CAAMqB,EAAN,CAASC,IAAT,CAAc,QAAd;AACA/C,WAAGyB,EAAH,CAAMC,IAAN,CAAWC,WAAX,CAAuB,QAAvB,EAAgC,EAACtB,SAAQ,KAAKA,OAAd,EAAsBO,MAAK,KAAKA,IAAhC,EAAhC,EAAsE4B,OAAtE;AACH,KAzEI;;AA2ELQ,YAAO,gBAASJ,IAAT,EAAc;AACjB,YAAId,OAAO,IAAX;AACA,YAAImB,WAAW,SAAXA,QAAW,CAASpB,GAAT,EAAa;AACxB,gBAAGA,IAAIG,OAAJ,KAAgB,CAAnB,EAAqB;AACjBC,wBAAQC,GAAR,CAAYL,IAAIM,MAAhB;AACH,aAFD,MAGI;AACAL,qBAAKS,KAAL;AACH;AACJ,SAPD;;AASA,YAAIW,OAAO;AACP7C,qBAAQ,KAAKA,OADN;AAEPO,kBAAK,KAAKA,IAFH;AAGPgC,kBAAKA;AAHE,SAAX;AAKA5C,WAAGyB,EAAH,CAAMC,IAAN,CAAWC,WAAX,CAAuB,cAAvB,EAAsCuB,IAAtC,EAA2CD,QAA3C;AACH,KA5FI;;AA8FLE,eAAU,mBAASC,MAAT,EAAgBC,QAAhB,EAAyB;AAC/B,YAAIvB,OAAO,IAAX;AACA,YAAIwB,UAAU,SAAVA,OAAU,CAASzB,GAAT,EAAa;AACvB,gBAAGA,IAAIG,OAAJ,KAAgB,CAAnB,EAAqB;AACjB,oBAAGH,IAAIG,OAAJ,IAAe,CAAC,CAAnB,EAAqB;AACjBuB,+BAAW,YAAU;AACjBzB,6BAAKqB,SAAL,CAAeC,MAAf,EAAsBC,QAAtB;AACH,qBAFD,EAEE,IAFF;AAGH,iBAJD,MAKI;AACArD,uBAAGyB,EAAH,CAAMqB,EAAN,CAASU,IAAT;AACA,wBAAGH,YAAY,IAAf,EAAoB;AAChBA,iCAASxB,GAAT;AACH;AACJ;AACJ,aAZD,MAaI;AACA,oBAAGwB,YAAY,IAAf,EAAoB;AAChBA,6BAASxB,GAAT;AACH;AACD7B,mBAAGyB,EAAH,CAAMgC,UAAN,CAAiBC,iBAAjB,CAAmC7B,GAAnC;AACH;AACJ,SApBD;;AAsBA,YAAIqB,OAAO;AACP7C,qBAAQL,GAAGyB,EAAH,CAAMM,OAAN,CAAc1B,OADf;AAEPO,kBAAKZ,GAAGyB,EAAH,CAAMM,OAAN,CAAcnB,IAFZ;AAGPiC,oBAAOO;AAHA,SAAX;AAKApD,WAAGyB,EAAH,CAAMqB,EAAN,CAASC,IAAT,CAAc,YAAYK,MAA1B;AACApD,WAAGyB,EAAH,CAAMC,IAAN,CAAWC,WAAX,CAAuB,qBAAvB,EAA6CuB,IAA7C,EAAkDI,OAAlD;AACH,KA7HI;AA8HLK,oBAAe,wBAASN,QAAT,EAAkB;AAC7B,YAAIvB,OAAO,IAAX;AACA,YAAI8B,QAAQ,SAARA,KAAQ,CAAS/B,GAAT,EAAa;AACrB,gBAAGA,IAAIG,OAAJ,KAAgB,CAAnB,EAAqB;AACjBC,wBAAQC,GAAR,CAAYL,IAAIM,MAAhB;AACH,aAFD,MAGI;AACAF,wBAAQC,GAAR,CAAYL,IAAIgC,OAAhB;AACA,oBAAGR,YAAY,IAAf,EAAoB;AAChBA,6BAASxB,IAAIgC,OAAb;AACH;AACJ;AACJ,SAVD;;AAYA,YAAIX,OAAO;AACP7C,qBAAQL,GAAGyB,EAAH,CAAMM,OAAN,CAAc1B,OADf;AAEPO,kBAAKZ,GAAGyB,EAAH,CAAMM,OAAN,CAAcnB;AAFZ,SAAX;AAIAZ,WAAGyB,EAAH,CAAMC,IAAN,CAAWC,WAAX,CAAuB,mBAAvB,EAA2CuB,IAA3C,EAAgDU,KAAhD;AACH,KAjJI;AAkJLE,oBAAe,wBAASC,IAAT,EAAcV,QAAd,EAAuB;AAClC,YAAIvB,OAAO,IAAX;AACA,YAAI8B,QAAQ,SAARA,KAAQ,CAAS/B,GAAT,EAAa;AACrB,gBAAGA,IAAIG,OAAJ,KAAgB,CAAnB,EAAqB;AACjBC,wBAAQC,GAAR,CAAYL,IAAIM,MAAhB;AACH,aAFD,MAGI;AACAF,wBAAQC,GAAR,CAAYL,IAAIqB,IAAhB;AACAG,yBAASxB,IAAIqB,IAAb;AACH;AACJ,SARD;;AAUA,YAAIA,OAAO;AACP7C,qBAAQL,GAAGyB,EAAH,CAAMM,OAAN,CAAc1B,OADf;AAEPO,kBAAKZ,GAAGyB,EAAH,CAAMM,OAAN,CAAcnB,IAFZ;AAGPmD,kBAAKA;AAHE,SAAX;AAKA/D,WAAGyB,EAAH,CAAMC,IAAN,CAAWC,WAAX,CAAuB,oBAAvB,EAA4CuB,IAA5C,EAAiDU,KAAjD;AACH,KApKI;;AAsKLI,qBAAgB,yBAASD,IAAT,EAAcE,KAAd,EAAoBZ,QAApB,EAA6B;AACzC,YAAIvB,OAAO,IAAX;AACA,YAAI8B,QAAQ,SAARA,KAAQ,CAAS/B,GAAT,EAAa;AACrB,gBAAGA,IAAIG,OAAJ,KAAgB,CAAnB,EAAqB;AACjBC,wBAAQC,GAAR,CAAYL,IAAIM,MAAhB;AACH,aAFD,MAGI;AACAF,wBAAQC,GAAR,CAAYL,IAAIqB,IAAhB;AACAG,yBAASxB,IAAIqB,IAAb;AACH;AACJ,SARD;;AAUA,YAAIA,OAAO;AACP7C,qBAAQL,GAAGyB,EAAH,CAAMM,OAAN,CAAc1B,OADf;AAEPO,kBAAKZ,GAAGyB,EAAH,CAAMM,OAAN,CAAcnB,IAFZ;AAGPmD,kBAAKA,IAHE;AAIPE,mBAAMA;AAJC,SAAX;AAMAjE,WAAGyB,EAAH,CAAMC,IAAN,CAAWC,WAAX,CAAuB,qBAAvB,EAA6CuB,IAA7C,EAAkDU,KAAlD;AACH;AAzLI,CAAT","file":"unknown","sourcesContent":["cc.Class({\n    extends: cc.Component,\n    properties: {\n        account:null,\n\t    userId:null,\n\t\tuserName:null,\n\t\tlv:0,\n\t\texp:0,\n\t\tcoins:0,\n\t\tgems:0,\n\t\tsign:0,\n        ip:\"\",\n        sex:0,\n        roomData:null,\n        oldRoomId:null,\n    },\n    \n    guestAuth:function(){\n        var account = cc.args[\"account\"];\n        if(account == null){\n            account = cc.sys.localStorage.getItem(\"account\");\n        }\n        \n        if(account == null){\n            account = Date.now();\n            cc.sys.localStorage.setItem(\"account\",account);\n        }\n        \n        cc.vv.http.sendRequest(\"/guest\",{account:account},this.onAuth);\n    },\n    \n    onAuth:function(ret){\n        var self = cc.vv.userMgr;\n        if(ret.errcode !== 0){\n            console.log(ret.errmsg);\n        }\n        else{\n            self.account = ret.account;\n            self.sign = ret.sign;\n            cc.vv.http.url = \"http://\" + cc.vv.SI.hall;\n            self.login();\n        }   \n    },\n    \n    login:function(){\n        var self = this;\n        var onLogin = function(ret){\n            if(ret.errcode !== 0){\n                console.log(ret.errmsg);\n            }\n            else{\n                if(!ret.userid){\n                    //jump to register user info.\n                    cc.director.loadScene(\"createrole\");\n                }\n                else{\n                    console.log(ret);\n                    self.account = ret.account;\n        \t\t\tself.userId = ret.userid;\n        \t\t\tself.userName = ret.name;\n        \t\t\tself.lv = ret.lv;\n        \t\t\tself.exp = ret.exp;\n        \t\t\tself.coins = ret.coins;\n        \t\t\tself.gems = ret.gems;\n                    self.roomData = ret.roomid;\n                    self.sex = ret.sex;\n                    self.ip = ret.ip;\n        \t\t\tcc.director.loadScene(\"hall\");\n                }\n            }\n        };\n        cc.vv.wc.show(\"正在登录游戏\");\n        cc.vv.http.sendRequest(\"/login\",{account:this.account,sign:this.sign},onLogin);\n    },\n    \n    create:function(name){\n        var self = this;\n        var onCreate = function(ret){\n            if(ret.errcode !== 0){\n                console.log(ret.errmsg);\n            }\n            else{\n                self.login();\n            }\n        };\n        \n        var data = {\n            account:this.account,\n            sign:this.sign,\n            name:name\n        };\n        cc.vv.http.sendRequest(\"/create_user\",data,onCreate);    \n    },\n    \n    enterRoom:function(roomId,callback){\n        var self = this;\n        var onEnter = function(ret){\n            if(ret.errcode !== 0){\n                if(ret.errcode == -1){\n                    setTimeout(function(){\n                        self.enterRoom(roomId,callback);\n                    },5000);\n                }\n                else{\n                    cc.vv.wc.hide();\n                    if(callback != null){\n                        callback(ret);\n                    }\n                }\n            }\n            else{\n                if(callback != null){\n                    callback(ret);\n                }\n                cc.vv.gameNetMgr.connectGameServer(ret);\n            }\n        };\n        \n        var data = {\n            account:cc.vv.userMgr.account,\n            sign:cc.vv.userMgr.sign,\n            roomid:roomId\n        };\n        cc.vv.wc.show(\"正在进入房间 \" + roomId);\n        cc.vv.http.sendRequest(\"/enter_private_room\",data,onEnter);\n    },\n    getHistoryList:function(callback){\n        var self = this;\n        var onGet = function(ret){\n            if(ret.errcode !== 0){\n                console.log(ret.errmsg);\n            }\n            else{\n                console.log(ret.history);\n                if(callback != null){\n                    callback(ret.history);\n                }\n            }\n        };\n        \n        var data = {\n            account:cc.vv.userMgr.account,\n            sign:cc.vv.userMgr.sign,\n        };\n        cc.vv.http.sendRequest(\"/get_history_list\",data,onGet);\n    },\n    getGamesOfRoom:function(uuid,callback){\n        var self = this;\n        var onGet = function(ret){\n            if(ret.errcode !== 0){\n                console.log(ret.errmsg);\n            }\n            else{\n                console.log(ret.data);\n                callback(ret.data);\n            }\n        };\n        \n        var data = {\n            account:cc.vv.userMgr.account,\n            sign:cc.vv.userMgr.sign,\n            uuid:uuid,\n        };\n        cc.vv.http.sendRequest(\"/get_games_of_room\",data,onGet);\n    },\n    \n    getDetailOfGame:function(uuid,index,callback){\n        var self = this;\n        var onGet = function(ret){\n            if(ret.errcode !== 0){\n                console.log(ret.errmsg);\n            }\n            else{\n                console.log(ret.data);\n                callback(ret.data);\n            }       \n        };\n        \n        var data = {\n            account:cc.vv.userMgr.account,\n            sign:cc.vv.userMgr.sign,\n            uuid:uuid,\n            index:index,\n        };\n        cc.vv.http.sendRequest(\"/get_detail_of_game\",data,onGet);\n    }\n});\n"]}