{"version":3,"sources":["assets/scripts/ReplayMgr.js"],"names":["ACTION_CHUPAI","ACTION_MOPAI","ACTION_PENG","ACTION_GANG","ACTION_HU","ACTION_CHI","ACTION_BUHUA","cc","Class","extends","Component","properties","_lastAction","_actionRecords","_currentIndex","onLoad","clear","init","data","action_records","isReplay","getNextAction","actions","concat","splice","console","log","length","si","action","pai","type","chigroup","buhuas","holds","takeAction","vv","gameNetMgr","doGuo","nextActionDelay","doChupai","doMopai","doTurnChange","doPeng","dispatchEvent","doGang","doHu","seatindex","hupai","iszimo","doChi","doBuhuaforme","doBuhua"],"mappings":"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","file":"unknown","sourcesContent":["var ACTION_CHUPAI = 1;\nvar ACTION_MOPAI = 2;\nvar ACTION_PENG = 3;\nvar ACTION_GANG = 4;\nvar ACTION_HU = 5;\nvar ACTION_CHI =7;\nvar ACTION_BUHUA =8;\n\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        // foo: {\n        //    default: null,\n        //    url: cc.Texture2D,  // optional, default is typeof default\n        //    serializable: true, // optional, default is true\n        //    visible: true,      // optional, default is true\n        //    displayName: 'Foo', // optional\n        //    readonly: false,    // optional, default is false\n        // },\n        // ...\n        _lastAction:null,\n        _actionRecords:null,\n        _currentIndex:0,\n    },\n\n    // use this for initialization\n    onLoad: function () {\n\n    },\n    \n    clear:function(){\n        this._lastAction = null;\n        this._actionRecords = null;\n        this._currentIndex = 0;\n    },\n    \n    init:function(data){\n        this._actionRecords = data.action_records;\n        if(this._actionRecords == null){\n            this._actionRecords = {};\n        }\n        this._currentIndex = 0;\n        this._lastAction = null;\n    },\n    \n    isReplay:function(){\n        return this._actionRecords != null;    \n    },\n    \n    getNextAction:function(){\n        var actions = [].concat(this._actionRecords);\n        actions.splice(0,this._currentIndex);\n        console.log(actions);\n        \n        if(this._currentIndex >= this._actionRecords.length){\n            return null;\n        }\n\n        var si = this._actionRecords[this._currentIndex++];\n        var action = this._actionRecords[this._currentIndex++];\n        if(action != ACTION_CHI && action != ACTION_BUHUA){\n            var pai = this._actionRecords[this._currentIndex++];\n            return {si:si,type:action,pai:pai};\n        }else if (action==ACTION_CHI){\n            var pai = this._actionRecords[this._currentIndex++];\n            var chigroup = this._actionRecords[this._currentIndex++];\n            return {si:si,type:action,pai:pai,chigroup:chigroup};\n        }else if (action==ACTION_BUHUA){\n            var buhuas = this._actionRecords[this._currentIndex++];\n            var holds = this._actionRecords[this._currentIndex++];\n            return {si:si,type:action,buhuas:buhuas,holds:holds};\n        }\n        \n        \n    },\n    \n    takeAction:function(){\n        var action = this.getNextAction();\n        if(this._lastAction != null && this._lastAction.type == ACTION_CHUPAI){\n            if(action != null && action.type != ACTION_PENG && action.type != ACTION_GANG && action.type != ACTION_HU){\n                cc.vv.gameNetMgr.doGuo(this._lastAction.si,this._lastAction.pai);\n            }\n        }\n        this._lastAction = action;\n        if(action == null){\n            return -1;\n        }\n        var nextActionDelay = 1.0;\n        if(action.type == ACTION_CHUPAI){\n            console.log(\"chupai\"+action.pai);\n            cc.vv.gameNetMgr.doChupai(action.si,action.pai);\n            return 1.0;\n        }\n        else if(action.type == ACTION_MOPAI){\n            console.log(\"mopai\"+action.pai);\n            cc.vv.gameNetMgr.doMopai(action.si,action.pai);\n            cc.vv.gameNetMgr.doTurnChange(action.si);\n            return 0.5;\n        }\n        else if(action.type == ACTION_PENG){\n            console.log(\"peng\"+action.pai);\n            cc.vv.gameNetMgr.doPeng(action.si,action.pai);\n            cc.vv.gameNetMgr.doTurnChange(action.si);\n            return 1.0;\n        }\n        else if(action.type == ACTION_GANG){\n            console.log(\"gang\"+action.pai);\n            cc.vv.gameNetMgr.dispatchEvent('hangang_notify',action.si);\n            cc.vv.gameNetMgr.doGang(action.si,action.pai);\n            cc.vv.gameNetMgr.doTurnChange(action.si);\n            return 1.0;\n        }\n        else if(action.type == ACTION_HU){\n            console.log(\"hu\"+action.pai);\n            cc.vv.gameNetMgr.doHu({seatindex:action.si,hupai:action.pai,iszimo:false});\n            return 1.5;\n        }\n        else if(action.type == ACTION_CHI){\n            console.log(\"chi\"+action.pai);\n            cc.vv.gameNetMgr.doChi(action.si,action.pai,action.chigroup);\n            return 1.5;\n        }\n        else if(action.type == ACTION_BUHUA){\n            console.log(\"chi\"+action.pai);\n            cc.vv.gameNetMgr.doBuhuaforme(action.si,action.holds,action.buhuas);\n             cc.vv.gameNetMgr.doBuhua(action.si,action.buhuas);\n            return 1.5;\n        }\n    }\n\n    // called every frame, uncomment this function to activate update callback\n    // update: function (dt) {\n\n    // },\n});\n"]}