{"version":3,"sources":["assets/scripts/components/Seat.js"],"names":["cc","Class","extends","Component","properties","_sprIcon","_zhuang","_ready","_offline","_lblName","_lblScore","_scoreBg","_nddayingjia","_voicemsg","_chatBubble","_emoji","_lastChatTime","_userName","_score","_dayingjia","_isOffline","_isReady","_isZhuang","_userId","onLoad","vv","node","getChildByName","getComponent","Label","_xuanpai","refreshXuanPaiState","active","Button","utils","addClickEvent","refresh","setUserID","onIconClicked","iconSprite","Sprite","seat","gameNetMgr","getSeatByID","sex","baseInfoMap","info","userinfoShow","show","name","userid","ip","string","numOfGames","setInfo","score","dayingjia","setZhuang","value","setReady","isReady","setID","id","idNode","lbl","setOffline","isOffline","chat","content","emoji","console","log","Animation","play","voiceMsg","isHuanSanZhang","huanpais","update","dt","stop"],"mappings":"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","file":"unknown","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        _sprIcon:null,\n        _zhuang:null,\n        _ready:null,\n        _offline:null,\n        _lblName:null,\n        _lblScore:null,\n        _scoreBg:null,\n        _nddayingjia:null,\n        _voicemsg:null,\n        \n        _chatBubble:null,\n        _emoji:null,\n        _lastChatTime:-1,\n        \n        _userName:\"\",\n        _score:0,\n        _dayingjia:false,\n        _isOffline:false,\n        _isReady:false,\n        _isZhuang:false,\n        _userId:null,\n    },\n\n    // use this for initialization\n    onLoad: function () {\n        if(cc.vv == null){\n            return;\n        }\n        \n        this._sprIcon = this.node.getChildByName(\"icon\").getComponent(\"ImageLoader\");\n        this._lblName = this.node.getChildByName(\"name\").getComponent(cc.Label);\n        this._lblScore = this.node.getChildByName(\"score\").getComponent(cc.Label);\n        this._voicemsg = this.node.getChildByName(\"voicemsg\");\n        this._xuanpai = this.node.getChildByName(\"xuanpai\");\n        this.refreshXuanPaiState();\n        \n        if(this._voicemsg){\n            this._voicemsg.active = false;\n        }\n        \n        if(this._sprIcon && this._sprIcon.getComponent(cc.Button)){\n            cc.vv.utils.addClickEvent(this._sprIcon,this.node,\"Seat\",\"onIconClicked\");    \n        }\n        \n        \n        this._offline = this.node.getChildByName(\"offline\");\n        \n        this._ready = this.node.getChildByName(\"ready\");\n        \n        this._zhuang = this.node.getChildByName(\"zhuang\");\n        \n        this._scoreBg = this.node.getChildByName(\"Z_money_frame\");\n        this._nddayingjia = this.node.getChildByName(\"dayingjia\");\n        \n        this._chatBubble = this.node.getChildByName(\"ChatBubble\");\n        if(this._chatBubble != null){\n            this._chatBubble.active = false;            \n        }\n        \n        this._emoji = this.node.getChildByName(\"emoji\");\n        if(this._emoji != null){\n            this._emoji.active = false;\n        }\n        \n        this.refresh();\n        \n        if(this._sprIcon && this._userId){\n            this._sprIcon.setUserID(this._userId);\n        }\n    },\n    \n    onIconClicked:function(){\n        var iconSprite = this._sprIcon.node.getComponent(cc.Sprite);\n        if(this._userId != null && this._userId > 0){\n           var seat = cc.vv.gameNetMgr.getSeatByID(this._userId);\n            var sex = 0;\n            if(cc.vv.baseInfoMap){\n                var info = cc.vv.baseInfoMap[this._userId];\n                if(info){\n                    sex = info.sex;\n                }                \n            }\n            cc.vv.userinfoShow.show(seat.name,seat.userid,iconSprite,sex,seat.ip);         \n        }\n    },\n    \n    refresh:function(){\n        if(this._lblName != null){\n            this._lblName.string = this._userName;    \n        }\n        \n        if(this._lblScore != null){\n            this._lblScore.string = this._score;            \n        }        \n        \n        if(this._nddayingjia != null){\n            this._nddayingjia.active = this._dayingjia == true;\n        }\n        \n        if(this._offline){\n            this._offline.active = this._isOffline && this._userName != \"\";\n        }\n        \n        if(this._ready){\n            this._ready.active = this._isReady && (cc.vv.gameNetMgr.numOfGames > 0); \n        }\n        \n        if(this._zhuang){\n            this._zhuang.active = this._isZhuang;    \n        }\n        \n        this.node.active = this._userName != null && this._userName != \"\"; \n    },\n    \n    setInfo(name,score,dayingjia){\n        this._userName = name;\n        this._score = score;\n        if(this._score == null){\n            this._score = 0;\n        }\n        this._dayingjia = dayingjia;\n        \n        if(this._scoreBg != null){\n            this._scoreBg.active = this._score != null;            \n        }\n\n        if(this._lblScore != null){\n            this._lblScore.node.active = this._score != null;            \n        }\n\n        this.refresh();    \n    },\n    \n    setZhuang:function(value){\n        if(this._zhuang){\n            this._zhuang.active = value;\n        }\n    },\n    \n    setReady:function(isReady){\n        this._isReady = isReady;\n        if(this._ready){\n            this._ready.active = this._isReady && (cc.vv.gameNetMgr.numOfGames > 0); \n        }\n    },\n    \n    setID:function(id){\n        var idNode = this.node.getChildByName(\"id\");\n        if(idNode){\n            var lbl = idNode.getComponent(cc.Label);\n            lbl.string = \"ID:\" + id;            \n        }\n        \n        this._userId = id;\n        if(this._sprIcon){\n            this._sprIcon.setUserID(id); \n        }\n    },\n    \n    setOffline:function(isOffline){\n        this._isOffline = isOffline;\n        if(this._offline){\n            this._offline.active = this._isOffline && this._userName != \"\";\n        }\n    },\n    \n    chat:function(content){\n        if(this._chatBubble == null || this._emoji == null){\n            return;\n        }\n        this._emoji.active = false;\n        this._chatBubble.active = true;\n        this._chatBubble.getComponent(cc.Label).string = content;\n        this._chatBubble.getChildByName(\"New Label\").getComponent(cc.Label).string = content;\n        this._lastChatTime = 3;\n    },\n    \n    emoji:function(emoji){\n        //emoji = JSON.parse(emoji);\n        if(this._emoji == null || this._emoji == null){\n            return;\n        }\n        console.log(emoji);\n        this._chatBubble.active = false;\n        this._emoji.active = true;\n        this._emoji.getComponent(cc.Animation).play(emoji);\n        this._lastChatTime = 3;\n    },\n    \n    voiceMsg:function(show){\n        if(this._voicemsg){\n            this._voicemsg.active = show;\n        }\n    },\n    \n    refreshXuanPaiState:function(){\n        if(this._xuanpai == null){\n            return;\n        }\n        \n        this._xuanpai.active = cc.vv.gameNetMgr.isHuanSanZhang;\n        if(cc.vv.gameNetMgr.isHuanSanZhang == false){ \n            return;\n        }\n       \n        this._xuanpai.getChildByName(\"xz\").active = false;\n        this._xuanpai.getChildByName(\"xd\").active = false;\n        \n        var seat = cc.vv.gameNetMgr.getSeatByID(this._userId);\n        if(seat){\n            if(seat.huanpais == null){\n                this._xuanpai.getChildByName(\"xz\").active = true;\n            }\n            else{\n                this._xuanpai.getChildByName(\"xd\").active = true;\n            }\n        }\n    },\n   \n    // called every frame, uncomment this function to activate update callback\n    update: function (dt) {\n        if(this._lastChatTime > 0){\n            this._lastChatTime -= dt;\n            if(this._lastChatTime < 0){\n                this._chatBubble.active = false;\n                this._emoji.active = false;\n                this._emoji.getComponent(cc.Animation).stop();\n            }\n        }\n    },\n});\n"]}