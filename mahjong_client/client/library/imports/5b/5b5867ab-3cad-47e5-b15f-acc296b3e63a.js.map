{"version":3,"sources":["assets/scripts/components/TimePointer.js"],"names":["cc","Class","extends","Component","properties","_arrow","_pointer","_timeLabel","_time","_alertTime","onLoad","gameChild","node","getChildByName","initPointer","getComponent","Label","string","self","on","data","vv","active","gameNetMgr","gamestate","turn","localIndex","getLocalIndex","i","children","length","button","seatindex","seatIndex","arrow_frame","dis","rotation","update","dt","audioMgr","playSFX","pre","t","Math","ceil"],"mappings":"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","file":"unknown","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        _arrow:null,\n        _pointer:null,\n        _timeLabel:null,\n        _time:-1,\n        _alertTime:-1,\n        // foo: {\n        //    default: null,\n        //    url: cc.Texture2D,  // optional, default is typeof default\n        //    serializable: true, // optional, default is true\n        //    visible: true,      // optional, default is true\n        //    displayName: 'Foo', // optional\n        //    readonly: false,    // optional, default is false\n        // },\n        // ...\n    },\n\n    // use this for initialization\n    onLoad: function () {\n        var gameChild = this.node.getChildByName(\"game\");\n        this._arrow = gameChild.getChildByName(\"arrow\");\n        this._pointer = this._arrow.getChildByName(\"pointer\");\n        this.initPointer();\n        \n        this._timeLabel = this._arrow.getChildByName(\"lblTime\").getComponent(cc.Label);\n        this._timeLabel.string = \"00\";\n        \n        var self = this;\n        \n        this.node.on('game_begin',function(data){\n            self.initPointer();\n        });\n        \n        this.node.on('game_chupai',function(data){\n            self.initPointer();\n            self._time = 10;\n            self._alertTime = 3;\n        });\n    }, \n    \n    initPointer:function(){\n        \n        \n        if(cc.vv == null){\n            return;\n        }\n        \n        \n        \n        this._arrow.active = cc.vv.gameNetMgr.gamestate == \"playing\";\n        if(!this._arrow.active){\n            return;\n        }\n        var turn = cc.vv.gameNetMgr.turn;\n        var localIndex = cc.vv.gameNetMgr.getLocalIndex(turn);\n        for(var i = 0; i < this._pointer.children.length; ++i){\n            this._pointer.children[i].active = i == localIndex;\n        }\n        \n        //旋转风向\n        var button = cc.vv.gameNetMgr.button;\n        var seatindex = cc.vv.gameNetMgr.seatIndex;\n        var arrow_frame = this._arrow.getChildByName(\"Z_arrow_frame\");\n        var dis = seatindex - button;\n        arrow_frame.rotation = dis * 90;\n    },\n    \n    // called every frame, uncomment this function to activate update callback\n    update: function (dt) {\n        if(this._time > 0){\n            this._time -= dt;\n            if(this._alertTime > 0 && this._time < this._alertTime){\n                cc.vv.audioMgr.playSFX(\"timeup_alarm.mp3\");\n                this._alertTime = -1;\n            }\n            var pre = \"\";\n            if(this._time < 0){\n                this._time = 0;\n            }\n            \n            var t = Math.ceil(this._time);\n            if(t < 10){\n                pre = \"0\";\n            }\n            this._timeLabel.string = pre + t; \n        }\n    },\n});\n"]}