{"version":3,"sources":["assets/scripts/components/DingQue.js"],"names":["cc","Class","extends","Component","properties","queYiMen","tips","selected","dingques","onLoad","vv","initView","initDingQue","initEventHandlers","gameChild","node","getChildByName","active","gameNetMgr","isDingQueing","arr","i","length","side","seat","dingque","push","reset","childrenCount","n","children","getComponent","Label","gamestate","showDingQueChoice","self","on","data","seatIndex","getSeatIndexByID","detail","localIndex","getLocalIndex","console","log","sd","getSelfData","typeCounts","holds","pai","type","mahjongmgr","getMahjongType","min","minIndex","Animation","play","stop","seats","que","setInteractable","j","onQueYiMenClicked","event","target","name","net","send","value","Button","interactable"],"mappings":"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","file":"unknown","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        queYiMen:null,\n        tips:[],\n        selected:[],\n        dingques:[],\n        // foo: {\n        //    default: null,\n        //    url: cc.Texture2D,  // optional, default is typeof default\n        //    serializable: true, // optional, default is true\n        //    visible: true,      // optional, default is true\n        //    displayName: 'Foo', // optional\n        //    readonly: false,    // optional, default is false\n        // },\n        // ...\n    },\n\n    // use this for initialization\n    onLoad: function () {\n        if(cc.vv == null){\n            return;\n        }\n        this.initView();\n        this.initDingQue();\n        this.initEventHandlers();\n    },\n    \n    initView:function(){\n        var gameChild = this.node.getChildByName(\"game\");\n        this.queYiMen = gameChild.getChildByName(\"dingque\");\n        this.queYiMen.active = cc.vv.gameNetMgr.isDingQueing;\n        \n        var arr = [\"myself\",\"right\",\"up\",\"left\"];\n        for(var i = 0; i < arr.length; ++i){\n            var side = gameChild.getChildByName(arr[i]);\n            var seat = side.getChildByName(\"seat\");\n            var dingque = seat.getChildByName(\"que\");\n            this.dingques.push(dingque);\n        }\n        this.reset();\n        \n        var tips = this.queYiMen.getChildByName(\"tips\");\n        for(var i = 0; i < tips.childrenCount; ++i){\n            var n = tips.children[i];\n            this.tips.push(n.getComponent(cc.Label));\n        }\n        \n        if(cc.vv.gameNetMgr.gamestate == \"dingque\"){\n            this.showDingQueChoice();\n        }\n    },\n    \n    initEventHandlers:function(){\n        var self = this;\n        \n        this.node.on('game_dingque_notify',function(data){\n            var seatIndex = cc.vv.gameNetMgr.getSeatIndexByID(data.detail);\n            var localIndex = cc.vv.gameNetMgr.getLocalIndex(seatIndex);\n            console.log(\"game_dingque_notify:\" + localIndex);\n            self.tips[localIndex].node.active = true;\n        });\n        \n        this.node.on('game_dingque_finish',function(){\n            //通知每一个玩家定缺的花色\n            self.queYiMen.active = false;\n            cc.vv.gameNetMgr.isDingQueing = false;\n            self.initDingQue();\n        });\n    },\n    \n    showDingQueChoice:function(){\n        this.queYiMen.active = true;\n        var sd = cc.vv.gameNetMgr.getSelfData();\n        var typeCounts = [0,0,0];\n        for(var i = 0; i < sd.holds.length; ++i){\n            var pai = sd.holds[i];\n            var type = cc.vv.mahjongmgr.getMahjongType(pai);\n            typeCounts[type]++;\n        }\n        \n        var min = 65535;\n        var minIndex = 0;\n        for(var i = 0; i < typeCounts.length; ++i){\n            if(typeCounts[i] < min){\n                min = typeCounts[i];\n                minIndex = i;\n            }\n        }\n        \n        var arr = [\"tong\",\"tiao\",\"wan\"];\n        for(var i = 0; i < arr.length; ++i){\n            var node = this.queYiMen.getChildByName(arr[i]);\n            if(minIndex == i){\n                node.getComponent(cc.Animation).play(\"dingque_tuijian\");\n            }\n            else{\n                node.getComponent(cc.Animation).stop();\n            }\n            //this.queYiMen.getChildByName(arr[i]).getChildByName('jian').active = minIndex == i;    \n        }\n        \n        this.reset();\n        for(var i = 0; i < this.tips.length; ++i){\n            var n = this.tips[i];\n            if(i > 0){\n                n.node.active = false;                \n            }\n            else{\n                n.node.active = true;\n            }\n        }\n    },\n    \n    initDingQue:function(){\n        var arr = [\"tong\",\"tiao\",\"wan\"];\n        var data = cc.vv.gameNetMgr.seats;\n        for(var i = 0; i < data.length; ++i){\n            var que = data[i].dingque;\n            if(que == null || que < 0 || que >= arr.length){\n                que = null;\n            }\n            else{\n                que = arr[que]; \n            }\n            \n            var localIndex = cc.vv.gameNetMgr.getLocalIndex(i);\n            if(que){\n                this.dingques[localIndex].getChildByName(que).active = true;    \n            }\n        }\n    },\n    \n    reset:function(){\n        this.setInteractable(true);\n        \n        this.selected.push(this.queYiMen.getChildByName(\"tong_selected\"));\n        this.selected.push(this.queYiMen.getChildByName(\"tiao_selected\"));\n        this.selected.push(this.queYiMen.getChildByName(\"wan_selected\"));\n        for(var i = 0; i < this.selected.length; ++i){\n            this.selected[i].active = false;\n        }        \n        \n        for(var i = 0; i < this.dingques.length; ++i){\n            for(var j = 0; j < this.dingques[i].children.length; ++j){\n                this.dingques[i].children[j].active = false;    \n            }\n        }\n    },\n    \n    onQueYiMenClicked:function(event){\n        var type = 0;\n        if(event.target.name == \"tong\"){\n            type = 0;\n        }\n        else if(event.target.name == \"tiao\"){\n            type = 1;\n        }\n        else if(event.target.name == \"wan\"){\n            type = 2;\n        }\n        \n        for(var i = 0; i < this.selected.length; ++i){\n            this.selected[i].active = false;\n        }  \n        this.selected[type].active = true;\n        cc.vv.gameNetMgr.dingque = type;\n        cc.vv.net.send(\"dingque\",type);\n        \n        //this.setInteractable(false);\n    },\n    \n    setInteractable:function(value){\n        this.queYiMen.getChildByName(\"tong\").getComponent(cc.Button).interactable = value;\n        this.queYiMen.getChildByName(\"tiao\").getComponent(cc.Button).interactable = value;\n        this.queYiMen.getChildByName(\"wan\").getComponent(cc.Button).interactable = value;        \n    }\n\n    // called every frame, uncomment this function to activate update callback\n    // update: function (dt) {\n\n    // },\n});\n"]}