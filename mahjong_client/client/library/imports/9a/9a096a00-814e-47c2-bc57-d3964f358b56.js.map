{"version":3,"sources":["assets/scripts/components/HuanSanZhang.js"],"names":["cc","Class","extends","Component","properties","_huanpaitip","_huanpaiArr","onLoad","find","active","vv","gameNetMgr","isHuanSanZhang","showHuanpai","getSelfData","huanpais","initHuaipaiInfo","btnOk","utils","addClickEvent","node","self","on","data","detail","seatindex","seatIndex","i","length","y","target","idx","indexOf","splice","push","interactable","getChildByName","getComponent","Label","string","Button","huaipaiinfo","seat","Sprite","spriteFrame","mahjongmgr","getSpriteFrameByMJID","hpm","huanpaimethod","rotation","onHuanSanZhang","event","type","pai","mjId","nt","getMahjongType","p1","p2","p3","net","send"],"mappings":"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","file":"unknown","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        // foo: {\n        //    default: null,      // The default value will be used only when the component attaching\n        //                           to a node for the first time\n        //    url: cc.Texture2D,  // optional, default is typeof default\n        //    serializable: true, // optional, default is true\n        //    visible: true,      // optional, default is true\n        //    displayName: 'Foo', // optional\n        //    readonly: false,    // optional, default is false\n        // },\n        // ...\n        _huanpaitip:null,\n        _huanpaiArr:[]\n    },\n\n    // use this for initialization\n    onLoad: function () {\n        this._huanpaitip = cc.find(\"Canvas/huansanzhang\");\n        this._huanpaitip.active = cc.vv.gameNetMgr.isHuanSanZhang;\n        \n        if(this._huanpaitip.active){\n            this.showHuanpai(cc.vv.gameNetMgr.getSelfData().huanpais == null);\n        }\n        this.initHuaipaiInfo();\n        \n        var btnOk = cc.find(\"Canvas/huansanzhang/btn_ok\");\n        if(btnOk){\n            cc.vv.utils.addClickEvent(btnOk,this.node,\"HuanSanZhang\",\"onHuanSanZhang\");\n        }\n        \n        var self = this;\n        \n        this.node.on('game_huanpai',function(data){\n           self._huanpaitip.active = true;\n           self.showHuanpai(true);\n        });\n        \n        this.node.on('huanpai_notify',function(data){\n            if(data.detail.seatindex == cc.vv.gameNetMgr.seatIndex){\n                self.initHuaipaiInfo();    \n            }\n        });\n        \n        this.node.on('game_huanpai_over',function(data){\n            self._huanpaitip.active = false;\n            for(var i = 0; i < self._huanpaiArr.length; ++i){\n                self._huanpaiArr[i].y = 0;\n            }\n            self._huanpaiArr = [];\n            self.initHuaipaiInfo();\n        });\n        \n        this.node.on('game_huanpai_result',function(data){\n            cc.vv.gameNetMgr.isHuanSanZhang = false;\n            self._huanpaitip.active = false;\n            for(var i = 0; i < self._huanpaiArr.length; ++i){\n                self._huanpaiArr[i].y = 0;\n            }\n            self._huanpaiArr = [];\n        });\n        \n        this.node.on('mj_clicked',function(data){\n            var target = data.detail;\n            //如果已经点起来，则取消\n            var idx = self._huanpaiArr.indexOf(target); \n            if(idx != -1){\n                target.y = 0;\n                self._huanpaiArr.splice(idx,1);\n            }\n            else{\n                //如果是新的，则加入\n                if(self._huanpaiArr.length < 3){\n                    self._huanpaiArr.push(target);\n                    target.y = 15;\n                }\n            } \n        });\n    },\n    \n    showHuanpai:function(interactable){\n        this._huanpaitip.getChildByName(\"info\").getComponent(cc.Label).string = \"请选择三张一样花色的牌\";\n        this._huanpaitip.getChildByName(\"btn_ok\").getComponent(cc.Button).interactable = interactable;\n        this._huanpaitip.getChildByName(\"mask\").active = false;        \n    },\n    \n    initHuaipaiInfo:function(){\n        var huaipaiinfo = cc.find(\"Canvas/game/huanpaiinfo\");\n        var seat = cc.vv.gameNetMgr.getSelfData();\n        if(seat.huanpais == null){\n            huaipaiinfo.active = false;\n            return;\n        }\n        huaipaiinfo.active = true;\n        for(var i = 0; i < seat.huanpais.length; ++i){\n            huaipaiinfo.getChildByName(\"hp\" + (i + 1)).getComponent(cc.Sprite).spriteFrame = cc.vv.mahjongmgr.getSpriteFrameByMJID(\"M_\",seat.huanpais[i]);\n        }\n        \n        var hpm = huaipaiinfo.getChildByName(\"hpm\");\n        hpm.active = true;\n        if(cc.vv.gameNetMgr.huanpaimethod == 0){\n            hpm.rotation = 90;\n        }\n        else if(cc.vv.gameNetMgr.huanpaimethod == 1){\n            hpm.rotation = 0;\n        }\n        else if(cc.vv.gameNetMgr.huanpaimethod == 2){\n            hpm.rotation = 180;\n        }\n        else{\n            hpm.active = false;\n        }\n    },\n    \n    onHuanSanZhang:function(event){\n        if(this._huanpaiArr.length != 3){\n            return;\n        }\n        \n        var type = null;\n        for(var i = 0; i < this._huanpaiArr.length; ++i){\n            var pai = this._huanpaiArr[i].mjId;\n            var nt = cc.vv.mahjongmgr.getMahjongType(pai); \n            if(type == null){\n                type = nt;\n            }\n            else{\n                if(type != nt){\n                    return;\n                }\n            }\n        }\n        \n        var data = {\n            p1:this._huanpaiArr[0].mjId,\n            p2:this._huanpaiArr[1].mjId,\n            p3:this._huanpaiArr[2].mjId,\n        }\n        \n        this._huanpaitip.getChildByName(\"info\").getComponent(cc.Label).string = \"等待其他玩家选牌...\";\n        this._huanpaitip.getChildByName(\"btn_ok\").getComponent(cc.Button).interactable = false;\n        this._huanpaitip.getChildByName(\"mask\").active = true;\n        \n        cc.vv.net.send(\"huanpai\",data);\n    },\n\n    // called every frame, uncomment this function to activate update callback\n    // update: function (dt) {\n\n    // },\n});\n"]}