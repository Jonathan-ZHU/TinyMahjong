{"version":3,"sources":["assets/scripts/components/PopupMgr.js"],"names":["cc","Class","extends","Component","properties","_popuproot","_settings","_dissolveNotice","_endTime","_extraInfo","_noticeLabel","onLoad","vv","popupMgr","find","getChildByName","getComponent","Label","closeAll","addBtnHandler","self","node","on","event","data","detail","showDissolveNotice","start","gameNetMgr","dissoveData","btnName","btn","addClickEvent","target","component","handler","eventHandler","EventHandler","clickEvents","Button","push","onBtnClicked","name","net","send","active","showSettings","showDissolveRequest","Date","now","time","i","states","length","b","seats","update","dt","lastTime","m","Math","floor","s","ceil","str","string"],"mappings":"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","file":"unknown","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        // foo: {\n        //    default: null,\n        //    url: cc.Texture2D,  // optional, default is typeof default\n        //    serializable: true, // optional, default is true\n        //    visible: true,      // optional, default is true\n        //    displayName: 'Foo', // optional\n        //    readonly: false,    // optional, default is false\n        // },\n        // ...\n        _popuproot:null,\n        _settings:null,\n        _dissolveNotice:null,\n        \n        _endTime:-1,\n        _extraInfo:null,\n        _noticeLabel:null,\n    },\n\n    // use this for initialization\n    onLoad: function () {\n        if(cc.vv == null){\n            return;\n        }\n        \n        cc.vv.popupMgr = this;\n        \n        this._popuproot = cc.find(\"Canvas/popups\");\n        this._settings = cc.find(\"Canvas/popups/settings\");\n        this._dissolveNotice = cc.find(\"Canvas/popups/dissolve_notice\");\n        this._noticeLabel = this._dissolveNotice.getChildByName(\"info\").getComponent(cc.Label);\n        \n        this.closeAll();\n        \n        this.addBtnHandler(\"settings/btn_close\");\n        this.addBtnHandler(\"settings/btn_sqjsfj\");\n        this.addBtnHandler(\"dissolve_notice/btn_agree\");\n        this.addBtnHandler(\"dissolve_notice/btn_reject\");\n        this.addBtnHandler(\"dissolve_notice/btn_ok\");\n        \n        var self = this;\n        this.node.on(\"dissolve_notice\",function(event){\n            var data = event.detail;\n            self.showDissolveNotice(data);\n        });\n        \n        this.node.on(\"dissolve_cancel\",function(event){\n            self.closeAll();\n        });\n    },\n    \n    start:function(){\n        if(cc.vv.gameNetMgr.dissoveData){\n            this.showDissolveNotice(cc.vv.gameNetMgr.dissoveData);\n        }\n    },\n    \n    addBtnHandler:function(btnName){\n        var btn = cc.find(\"Canvas/popups/\" + btnName);\n        this.addClickEvent(btn,this.node,\"PopupMgr\",\"onBtnClicked\");\n    },\n    \n    addClickEvent:function(node,target,component,handler){\n        var eventHandler = new cc.Component.EventHandler();\n        eventHandler.target = target;\n        eventHandler.component = component;\n        eventHandler.handler = handler;\n\n        var clickEvents = node.getComponent(cc.Button).clickEvents;\n        clickEvents.push(eventHandler);\n    },\n    \n    onBtnClicked:function(event){\n        this.closeAll();\n        var btnName = event.target.name;\n        if(btnName == \"btn_agree\"){\n            cc.vv.net.send(\"dissolve_agree\");\n        }\n        else if(btnName == \"btn_reject\"){\n            cc.vv.net.send(\"dissolve_reject\");\n        }\n        else if(btnName == \"btn_sqjsfj\"){\n            cc.vv.net.send(\"dissolve_request\"); \n        }\n    },\n    \n    closeAll:function(){\n        this._popuproot.active = false;\n        this._settings.active = false;\n        this._dissolveNotice.active = false;\n    },\n    \n    showSettings:function(){\n        this.closeAll();\n        this._popuproot.active = true;\n        this._settings.active = true;\n    },\n    \n    showDissolveRequest:function(){\n        this.closeAll();\n        this._popuproot.active = true;\n    },\n    \n    showDissolveNotice:function(data){\n        this._endTime = Date.now()/1000 + data.time;\n        this._extraInfo = \"\";\n        for(var i = 0; i < data.states.length; ++i){\n            var b = data.states[i];\n            var name = cc.vv.gameNetMgr.seats[i].name;\n            if(b){\n                this._extraInfo += \"\\n[已同意] \"+ name;\n            }\n            else{\n                this._extraInfo += \"\\n[待确认] \"+ name;\n            }\n        }\n        this.closeAll();\n        this._popuproot.active = true;\n        this._dissolveNotice.active = true;;\n    },\n    \n    // called every frame, uncomment this function to activate update callback\n    update: function (dt) {\n        if(this._endTime > 0){\n            var lastTime = this._endTime - Date.now() / 1000;\n            if(lastTime < 0){\n                this._endTime = -1;\n            }\n            \n            var m = Math.floor(lastTime / 60);\n            var s = Math.ceil(lastTime - m*60);\n            \n            var str = \"\";\n            if(m > 0){\n                str += m + \"分\"; \n            }\n            \n            this._noticeLabel.string = str + s + \"秒后房间将自动解散\" + this._extraInfo;\n        }\n    },\n});\n"]}