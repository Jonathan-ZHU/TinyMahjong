{"version":3,"sources":["assets/scripts/AnysdkMgr.js"],"names":["cc","Class","extends","Component","properties","_isCapturing","onLoad","init","ANDROID_API","IOS_API","ANDROID_WEBPAGE_API","openDownloadPage","console","log","sys","os","OS_ANDROID","jsb","reflection","callStaticMethod","vv","SI","appweb","OS_IOS","login","share","title","desc","shareOnTimeline","copy","shareResult","size","director","getWinSize","currentDate","Date","fileName","fullPath","fileUtils","getWritablePath","isFileExist","removeFile","texture","RenderTexture","Math","floor","width","height","setPosition","p","begin","getRunningScene","visit","end","saveToFile","IMAGE_FORMAT_JPG","self","tryTimes","fn","scale","setTimeout","onLoginResp","code","ret","errcode","localStorage","setItem","account","sign","userMgr","onAuth","http","sendRequest"],"mappings":"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","file":"unknown","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        // foo: {\n        //    default: null,      // The default value will be used only when the component attaching\n        //                           to a node for the first time\n        //    url: cc.Texture2D,  // optional, default is typeof default\n        //    serializable: true, // optional, default is true\n        //    visible: true,      // optional, default is true\n        //    displayName: 'Foo', // optional\n        //    readonly: false,    // optional, default is false\n        // },\n        // ...\n        _isCapturing:false,\n    },\n\n    // use this for initialization\n    onLoad: function () {\n    },\n\n    // called every frame, uncomment this function to activate update callback\n    // update: function (dt) {\n\n    // },\n    \n    \n\n    \n    init:function(){\n        this.ANDROID_API = \"com/vivigames/scmj/WXAPI\";\n        this.IOS_API = \"AppController\";\n        this.ANDROID_WEBPAGE_API = \"org/cocos2dx/javascript/AppActivity\";\n    },\n    \n    openDownloadPage:function () {\n        console.log(\"open webpage!!!\");\n        console.log(cc.sys.os);\n        console.log(cc.sys.OS_ANDROID);\n        if(cc.sys.os == cc.sys.OS_ANDROID){\n            console.log(\"open webpage OS_ANDROID!!!\");\n            jsb.reflection.callStaticMethod(this.ANDROID_WEBPAGE_API, \"openDownloadPage\", \"(Ljava/lang/String;)V\",cc.vv.SI.appweb);\n        }\n        else if(cc.sys.os == cc.sys.OS_IOS){\n            jsb.reflection.callStaticMethod(this.IOS_API, \"openDownloadPage\");\n        }\n        else{\n            console.log(\"platform:\" + cc.sys.os + \" dosn't implement share.\");\n        }\n    },\n    \n    login:function(){\n        if(cc.sys.os == cc.sys.OS_ANDROID){ \n            jsb.reflection.callStaticMethod(this.ANDROID_API, \"Login\", \"()V\");\n        }\n        else if(cc.sys.os == cc.sys.OS_IOS){\n            jsb.reflection.callStaticMethod(this.IOS_API, \"login\");\n        }\n        else{\n            console.log(\"platform:\" + cc.sys.os + \" dosn't implement share.\");\n        }\n    },\n    \n    share:function(title,desc){\n        if(cc.sys.os == cc.sys.OS_ANDROID){\n            jsb.reflection.callStaticMethod(this.ANDROID_API, \"Share\", \"(Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;)V\",cc.vv.SI.appweb,title,desc);\n        }\n        else if(cc.sys.os == cc.sys.OS_IOS){\n            jsb.reflection.callStaticMethod(this.IOS_API, \"share:shareTitle:shareDesc:\",cc.vv.SI.appweb,title,desc);\n        }\n        else{\n            console.log(\"platform:\" + cc.sys.os + \" dosn't implement share.\");\n        }\n    },\n    \n    shareOnTimeline:function(title,desc){\n        if(cc.sys.os == cc.sys.OS_ANDROID){\n            jsb.reflection.callStaticMethod(this.ANDROID_API, \"ShareOnTimeline\", \"(Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;)V\",cc.vv.SI.appweb,title,desc);\n        }\n        else if(cc.sys.os == cc.sys.OS_IOS){\n            jsb.reflection.callStaticMethod(this.IOS_API, \"sharetimeline:shareTitle:shareDesc:\",cc.vv.SI.appweb,title,desc);\n        }\n        else{\n            console.log(\"platform:\" + cc.sys.os + \" dosn't implement share.\");\n        }\n    },\n    \n    copy:function (desc) {\n        if(cc.sys.os == cc.sys.OS_ANDROID){\n            jsb.reflection.callStaticMethod(this.ANDROID_WEBPAGE_API, \"Copy\", \"(Ljava/lang/String;)V\",desc);\n        }\n        else if(cc.sys.os == cc.sys.OS_IOS){\n            jsb.reflection.callStaticMethod(this.IOS_API, \"copy:\",desc);\n        }\n        else{\n            console.log(\"platform:\" + cc.sys.os + \" dosn't implement share.\");\n        }\n    },\n    \n    shareResult:function(){\n        if(this._isCapturing){\n            return;\n        }\n        this._isCapturing = true;\n        var size = cc.director.getWinSize();\n        var currentDate = new Date();\n        var fileName = \"result_share.jpg\";\n        var fullPath = jsb.fileUtils.getWritablePath() + fileName;\n        if(jsb.fileUtils.isFileExist(fullPath)){\n            jsb.fileUtils.removeFile(fullPath);\n        }\n        var texture = new cc.RenderTexture(Math.floor(size.width), Math.floor(size.height));\n        texture.setPosition(cc.p(size.width/2, size.height/2));\n        texture.begin();\n        cc.director.getRunningScene().visit();\n        texture.end();\n        texture.saveToFile(fileName, cc.IMAGE_FORMAT_JPG);\n        \n        var self = this;\n        var tryTimes = 0;\n        var fn = function(){\n            if(jsb.fileUtils.isFileExist(fullPath)){\n                var height = 100;\n                var scale = height/size.height;\n\t\t\t    var width = Math.floor(size.width * scale);\n                \n                if(cc.sys.os == cc.sys.OS_ANDROID){\n                    jsb.reflection.callStaticMethod(self.ANDROID_API, \"ShareIMG\", \"(Ljava/lang/String;II)V\",fullPath,width,height);\n                }\n                else if(cc.sys.os == cc.sys.OS_IOS){\n                    jsb.reflection.callStaticMethod(self.IOS_API, \"shareIMG:width:height:\",fullPath,width,height);\n                }\n                else{\n                    console.log(\"platform:\" + cc.sys.os + \" dosn't implement share.\");\n                }\n                self._isCapturing = false;\n            }\n            else{\n                tryTimes++;\n                if(tryTimes > 10){\n                    console.log(\"time out...\");\n                    return;\n                }\n                setTimeout(fn,50); \n            }\n        }\n        setTimeout(fn,50);\n    },\n    \n    onLoginResp:function(code){\n        var fn = function(ret){\n            if(ret.errcode == 0){\n                cc.sys.localStorage.setItem(\"wx_account\",ret.account);\n                cc.sys.localStorage.setItem(\"wx_sign\",ret.sign);\n            }\n            cc.vv.userMgr.onAuth(ret);\n        }\n        cc.vv.http.sendRequest(\"/wechat_auth\",{code:code,os:cc.sys.os},fn);\n    },\n});\n"]}