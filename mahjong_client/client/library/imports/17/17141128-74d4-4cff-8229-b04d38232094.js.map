{
  "version": 3,
  "sources": [
    "unknown"
  ],
  "names": [
    "cc",
    "Class",
    "extends",
    "Component",
    "properties",
    "updatePanel",
    "default",
    "type",
    "Node",
    "manifestUrl",
    "url",
    "RawAsset",
    "percent",
    "Label",
    "lblErr",
    "checkCb",
    "event",
    "log",
    "getEventCode",
    "jsb",
    "EventAssetsManager",
    "ERROR_NO_LOCAL_MANIFEST",
    "eventManager",
    "removeListener",
    "_checkListener",
    "ERROR_DOWNLOAD_MANIFEST",
    "ERROR_PARSE_MANIFEST",
    "ALREADY_UP_TO_DATE",
    "string",
    "director",
    "loadScene",
    "NEW_VERSION_FOUND",
    "_needUpdate",
    "active",
    "hotUpdate",
    "updateCb",
    "needRestart",
    "failed",
    "UPDATE_PROGRESSION",
    "getPercent",
    "percentByFile",
    "getPercentByFile",
    "msg",
    "getMessage",
    "toFixed",
    "UPDATE_FINISHED",
    "UPDATE_FAILED",
    "_failCount",
    "_am",
    "downloadFailedAssets",
    "ERROR_UPDATING",
    "getAssetId",
    "ERROR_DECOMPRESS",
    "_updateListener",
    "searchPaths",
    "fileUtils",
    "getSearchPaths",
    "newPaths",
    "getLocalManifest",
    "Array",
    "prototype",
    "unshift",
    "sys",
    "localStorage",
    "setItem",
    "JSON",
    "stringify",
    "setSearchPaths",
    "game",
    "restart",
    "EventListenerAssetsManager",
    "bind",
    "addListener",
    "update",
    "onLoad",
    "isNative",
    "storagePath",
    "getWritablePath",
    "AssetsManager",
    "retain",
    "isLoaded",
    "checkUpdate",
    "onDestroy",
    "release"
  ],
  "mappings": "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",
  "file": "unknown",
  "sourcesContent": [
    "cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        updatePanel: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        manifestUrl: {\r\n            default: null,\r\n            url: cc.RawAsset\r\n        },\r\n        percent: {\r\n            default: null,\r\n            type: cc.Label\r\n        },\r\n        lblErr: {\r\n            default: null,\r\n            type: cc.Label\r\n        }\r\n    },\r\n\r\n    checkCb: function (event) {\r\n        cc.log('Code: ' + event.getEventCode());\r\n        switch (event.getEventCode())\r\n        {\r\n            case jsb.EventAssetsManager.ERROR_NO_LOCAL_MANIFEST:\r\n                cc.log(\"No local manifest file found, hot update skipped.\");\r\n                cc.eventManager.removeListener(this._checkListener);\r\n                break;\r\n            case jsb.EventAssetsManager.ERROR_DOWNLOAD_MANIFEST:\r\n            case jsb.EventAssetsManager.ERROR_PARSE_MANIFEST:\r\n                cc.log(\"Fail to download manifest file, hot update skipped.\");\r\n                cc.eventManager.removeListener(this._checkListener);\r\n                break;\r\n            case jsb.EventAssetsManager.ALREADY_UP_TO_DATE:\r\n                cc.log(\"Already up to date with the latest remote version.\");\r\n                cc.eventManager.removeListener(this._checkListener);\r\n                this.lblErr.string += \"游戏不需要更新\\n\";\r\n                cc.director.loadScene(\"loading\");\r\n                break;\r\n            case jsb.EventAssetsManager.NEW_VERSION_FOUND:\r\n                this._needUpdate = true;\r\n                this.updatePanel.active = true;\r\n                this.percent.string = '00.00%';\r\n                cc.eventManager.removeListener(this._checkListener);\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n        this.hotUpdate();\r\n    },\r\n\r\n    updateCb: function (event) {\r\n        var needRestart = false;\r\n        var failed = false;\r\n        switch (event.getEventCode())\r\n        {\r\n            case jsb.EventAssetsManager.ERROR_NO_LOCAL_MANIFEST:\r\n                cc.log('No local manifest file found, hot update skipped.');\r\n                failed = true;\r\n                break;\r\n            case jsb.EventAssetsManager.UPDATE_PROGRESSION:\r\n                var percent = event.getPercent();\r\n                var percentByFile = event.getPercentByFile();\r\n\r\n                var msg = event.getMessage();\r\n                if (msg) {\r\n                    cc.log(msg);\r\n                }\r\n                cc.log(percent.toFixed(2) + '%');\r\n                this.percent.string = percent + '%';\r\n                break;\r\n            case jsb.EventAssetsManager.ERROR_DOWNLOAD_MANIFEST:\r\n            case jsb.EventAssetsManager.ERROR_PARSE_MANIFEST:\r\n                cc.log('Fail to download manifest file, hot update skipped.');\r\n                failed = true;\r\n                break;\r\n            case jsb.EventAssetsManager.ALREADY_UP_TO_DATE:\r\n                cc.log('Already up to date with the latest remote version.');\r\n                failed = true;\r\n                break;\r\n            case jsb.EventAssetsManager.UPDATE_FINISHED:\r\n                cc.log('Update finished. ' + event.getMessage());\r\n\r\n                needRestart = true;\r\n                break;\r\n            case jsb.EventAssetsManager.UPDATE_FAILED:\r\n                cc.log('Update failed. ' + event.getMessage());\r\n\r\n                this._failCount ++;\r\n                if (this._failCount < 5)\r\n                {\r\n                    this._am.downloadFailedAssets();\r\n                }\r\n                else\r\n                {\r\n                    cc.log('Reach maximum fail count, exit update process');\r\n                    this._failCount = 0;\r\n                    failed = true;\r\n                }\r\n                break;\r\n            case jsb.EventAssetsManager.ERROR_UPDATING:\r\n                cc.log('Asset update error: ' + event.getAssetId() + ', ' + event.getMessage());\r\n                break;\r\n            case jsb.EventAssetsManager.ERROR_DECOMPRESS:\r\n                cc.log(event.getMessage());\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n\r\n        if (failed) {\r\n            cc.eventManager.removeListener(this._updateListener);\r\n            this.updatePanel.active = false;\r\n        }\r\n\r\n        if (needRestart) {\r\n            cc.eventManager.removeListener(this._updateListener);\r\n            // Prepend the manifest's search path\r\n            var searchPaths = jsb.fileUtils.getSearchPaths();\r\n            var newPaths = this._am.getLocalManifest().getSearchPaths();\r\n            Array.prototype.unshift(searchPaths, newPaths);\r\n            // This value will be retrieved and appended to the default search path during game startup,\r\n            // please refer to samples/js-tests/main.js for detailed usage.\r\n            // !!! Re-add the search paths in main.js is very important, otherwise, new scripts won't take effect.\r\n            cc.sys.localStorage.setItem('HotUpdateSearchPaths', JSON.stringify(searchPaths));\r\n\r\n            jsb.fileUtils.setSearchPaths(searchPaths);\r\n            this.lblErr.string += \"游戏资源更新完毕\\n\";\r\n            cc.game.restart();\r\n        }\r\n    },\r\n\r\n    hotUpdate: function () {\r\n        if (this._am && this._needUpdate) {\r\n            this.lblErr.string += \"开始更新游戏资源...\\n\";\r\n            this._updateListener = new jsb.EventListenerAssetsManager(this._am, this.updateCb.bind(this));\r\n            cc.eventManager.addListener(this._updateListener, 1);\r\n\r\n            this._failCount = 0;\r\n            this._am.update();\r\n        }\r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n        // Hot update is only available in Native build\r\n        if (!cc.sys.isNative) {\r\n            return;\r\n        }\r\n        this.lblErr.string += \"检查游戏资源...\\n\";\r\n        var storagePath = ((jsb.fileUtils ? jsb.fileUtils.getWritablePath() : '/') + 'tiantianqipai-asset');\r\n        cc.log('Storage path for remote asset : ' + storagePath);\r\n        this.lblErr.string += storagePath + \"\\n\";\r\n        cc.log('Local manifest URL : ' + this.manifestUrl);\r\n        this._am = new jsb.AssetsManager(this.manifestUrl, storagePath);\r\n        this._am.retain();\r\n\r\n        this._needUpdate = false;\r\n        if (this._am.getLocalManifest().isLoaded())\r\n        {\r\n            this._checkListener = new jsb.EventListenerAssetsManager(this._am, this.checkCb.bind(this));\r\n            cc.eventManager.addListener(this._checkListener, 1);\r\n\r\n            this._am.checkUpdate();\r\n        }\r\n    },\r\n\r\n    onDestroy: function () {\r\n        this._am && this._am.release();\r\n    }\r\n});\r\n"
  ]
}