{
  "version": 3,
  "sources": [
    "unknown"
  ],
  "names": [],
  "mappings": "AAAA,EAAE,CAAC,KAAK,CAAC;AACL,eAAS,EAAE,CAAC,SAAS;;AAErB,cAAU,EAAE;AACR,mBAAW,EAAE;AACT,uBAAS,IAAI;AACb,gBAAI,EAAE,EAAE,CAAC,IAAI;SAChB;AACD,mBAAW,EAAE;AACT,uBAAS,IAAI;AACb,eAAG,EAAE,EAAE,CAAC,QAAQ;SACnB;AACD,eAAO,EAAE;AACL,uBAAS,IAAI;AACb,gBAAI,EAAE,EAAE,CAAC,KAAK;SACjB;AACD,cAAM,EAAE;AACJ,uBAAS,IAAI;AACb,gBAAI,EAAE,EAAE,CAAC,KAAK;SACjB;KACJ;;AAED,WAAO,EAAE,iBAAU,KAAK,EAAE;AACtB,UAAE,CAAC,GAAG,CAAC,QAAQ,GAAG,KAAK,CAAC,YAAY,EAAE,CAAC,CAAC;AACxC,gBAAQ,KAAK,CAAC,YAAY,EAAE;AAExB,iBAAK,GAAG,CAAC,kBAAkB,CAAC,uBAAuB;AAC/C,kBAAE,CAAC,GAAG,CAAC,mDAAmD,CAAC,CAAC;;AAE5D,sBAAM;AAAA,AACV,iBAAK,GAAG,CAAC,kBAAkB,CAAC,uBAAuB,CAAC;AACpD,iBAAK,GAAG,CAAC,kBAAkB,CAAC,oBAAoB;AAC5C,kBAAE,CAAC,GAAG,CAAC,qDAAqD,CAAC,CAAC;;AAE9D,sBAAM;AAAA,AACV,iBAAK,GAAG,CAAC,kBAAkB,CAAC,kBAAkB;AAC1C,kBAAE,CAAC,GAAG,CAAC,oDAAoD,CAAC,CAAC;;AAE7D,oBAAI,CAAC,MAAM,CAAC,MAAM,IAAI,WAAW,CAAC;AAClC,kBAAE,CAAC,QAAQ,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC;AACjC,sBAAM;AAAA,AACV,iBAAK,GAAG,CAAC,kBAAkB,CAAC,iBAAiB;AACzC,oBAAI,CAAC,WAAW,GAAG,IAAI,CAAC;AACxB,oBAAI,CAAC,WAAW,CAAC,MAAM,GAAG,IAAI,CAAC;AAC/B,oBAAI,CAAC,OAAO,CAAC,MAAM,GAAG,QAAQ,CAAC;;AAE/B,sBAAM;AAAA,AACV;AACI,sBAAM;AAAA,SACb;AACD,YAAI,CAAC,SAAS,EAAE,CAAC;KACpB;;AAED,YAAQ,EAAE,kBAAU,KAAK,EAAE;AACvB,YAAI,WAAW,GAAG,KAAK,CAAC;AACxB,YAAI,MAAM,GAAG,KAAK,CAAC;AACnB,YAAI,IAAI,GAAG,KAAK,CAAC,YAAY,EAAE,CAAA;AAC/B,YAAI,CAAC,MAAM,CAAC,MAAM,GAAG,UAAU,GAAE,IAAI,GAAC,IAAI,CAAC;AAC3C,gBAAQ,IAAI;AAER,iBAAK,GAAG,CAAC,kBAAkB,CAAC,uBAAuB;AAAC;AAChD,sBAAE,CAAC,GAAG,CAAC,mDAAmD,CAAC,CAAC;AAC5D,wBAAI,CAAC,MAAM,CAAC,MAAM,IAAI,qDAAqD,CAAC;AAC5E,0BAAM,GAAG,IAAI,CAAC;AACd,0BAAM;iBACP;AAAA,AACH,iBAAK,GAAG,CAAC,kBAAkB,CAAC,kBAAkB;AAAC;AAC3C,wBAAI,OAAO,GAAG,KAAK,CAAC,UAAU,EAAE,CAAC;AACjC,wBAAI,aAAa,GAAG,KAAK,CAAC,gBAAgB,EAAE,CAAC;;AAE7C,wBAAI,GAAG,GAAG,KAAK,CAAC,UAAU,EAAE,CAAC;AAC7B,wBAAI,GAAG,EAAE;AACL,0BAAE,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;qBACf;AACD,sBAAE,CAAC,GAAG,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC;AACjC,wBAAI,CAAC,OAAO,CAAC,MAAM,GAAG,OAAO,GAAG,GAAG,CAAC;AACpC,0BAAM;iBACP;AAAA,AACH,iBAAK,GAAG,CAAC,kBAAkB,CAAC,uBAAuB;AAAC;AAClD,wBAAI,CAAC,MAAM,CAAC,MAAM,IAAI,2BAA2B,CAAC;iBAAC;AAAA,AACrD,iBAAK,GAAG,CAAC,kBAAkB,CAAC,oBAAoB;AAAC;AAC7C,sBAAE,CAAC,GAAG,CAAC,qDAAqD,CAAC,CAAC;AAC9D,wBAAI,CAAC,MAAM,CAAC,MAAM,IAAI,uDAAuD,CAAC;AAC9E,0BAAM,GAAG,IAAI,CAAC;AACd,0BAAM;iBAAC;AAAA,AACX,iBAAK,GAAG,CAAC,kBAAkB,CAAC,kBAAkB;AAAC;AAC3C,sBAAE,CAAC,GAAG,CAAC,oDAAoD,CAAC,CAAC;AAC7D,wBAAI,CAAC,MAAM,CAAC,MAAM,IAAI,sDAAsD,CAAC;AAC7E,0BAAM,GAAG,IAAI,CAAC;AACd,0BAAM;iBAAC;AAAA,AACX,iBAAK,GAAG,CAAC,kBAAkB,CAAC,eAAe;AAAC;AACxC,sBAAE,CAAC,GAAG,CAAC,mBAAmB,GAAG,KAAK,CAAC,UAAU,EAAE,CAAC,CAAC;AACjD,wBAAI,CAAC,MAAM,CAAC,MAAM,IAAI,mBAAmB,GAAG,KAAK,CAAC,UAAU,EAAE,GAAG,IAAI,CAAC;AACtE,+BAAW,GAAG,IAAI,CAAC;AACnB,0BAAM;iBAAC;AAAA,AACX,iBAAK,GAAG,CAAC,kBAAkB,CAAC,aAAa;AAAC;AACtC,sBAAE,CAAC,GAAG,CAAC,iBAAiB,GAAG,KAAK,CAAC,UAAU,EAAE,CAAC,CAAC;AAC9C,wBAAI,CAAC,MAAM,CAAC,MAAM,IAAI,iBAAiB,GAAG,KAAK,CAAC,UAAU,EAAE,GAAI,IAAI,CAAC;AACtE,wBAAI,CAAC,UAAU,EAAG,CAAC;AACnB,wBAAI,IAAI,CAAC,UAAU,GAAG,CAAC,EACvB;AACI,4BAAI,CAAC,GAAG,CAAC,oBAAoB,EAAE,CAAC;qBACnC,MAED;AACI,0BAAE,CAAC,GAAG,CAAC,+CAA+C,CAAC,CAAC;AACvD,4BAAI,CAAC,MAAM,CAAC,MAAM,IAAI,iDAAiD,CAAC;AACzE,4BAAI,CAAC,UAAU,GAAG,CAAC,CAAC;AACpB,8BAAM,GAAG,IAAI,CAAC;qBACjB;AACD,0BAAM;iBAAC;AAAA,AACX,iBAAK,GAAG,CAAC,kBAAkB,CAAC,cAAc;AAAC;AACvC,sBAAE,CAAC,GAAG,CAAC,sBAAsB,GAAG,KAAK,CAAC,UAAU,EAAE,GAAG,IAAI,GAAG,KAAK,CAAC,UAAU,EAAE,CAAC,CAAC;AAChF,wBAAI,CAAC,MAAM,CAAC,MAAM,IAAI,sBAAsB,GAAG,KAAK,CAAC,UAAU,EAAE,GAAG,IAAI,GAAG,KAAK,CAAC,UAAU,EAAE,GAAG,IAAI,CAAC;AACrG,0BAAM;iBAAC;AAAA,AACX,iBAAK,GAAG,CAAC,kBAAkB,CAAC,gBAAgB;AAAC;AACzC,sBAAE,CAAC,GAAG,CAAC,KAAK,CAAC,UAAU,EAAE,CAAC,CAAC;AAC3B,wBAAI,CAAC,MAAM,CAAC,MAAM,IAAI,KAAK,CAAC,UAAU,EAAE,GAAG,oBAAoB,CAAC;AAChE,0BAAM;iBAAC;AAAA,AACX;AAAQ;;AAEJ,0BAAM;iBAAC;AAAA,SACd;;AAED,YAAI,MAAM,EAAE;;AAER,gBAAI,CAAC,WAAW,CAAC,MAAM,GAAG,KAAK,CAAC;SACnC;;AAED,YAAI,WAAW,EAAE;;;AAGb,gBAAI,WAAW,GAAG,GAAG,CAAC,SAAS,CAAC,cAAc,EAAE,CAAC;AACjD,gBAAI,QAAQ,GAAG,IAAI,CAAC,GAAG,CAAC,gBAAgB,EAAE,CAAC,cAAc,EAAE,CAAC;AAC5D,iBAAK,CAAC,SAAS,CAAC,OAAO,CAAC,WAAW,EAAE,QAAQ,CAAC,CAAC;;;;AAI/C,cAAE,CAAC,GAAG,CAAC,YAAY,CAAC,OAAO,CAAC,sBAAsB,EAAE,IAAI,CAAC,SAAS,CAAC,WAAW,CAAC,CAAC,CAAC;;AAEjF,eAAG,CAAC,SAAS,CAAC,cAAc,CAAC,WAAW,CAAC,CAAC;AAC1C,gBAAI,CAAC,MAAM,CAAC,MAAM,IAAI,YAAY,CAAC;AACnC,cAAE,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC;SACrB;KACJ;;AAED,aAAS,EAAE,qBAAY;AACnB,YAAI,IAAI,CAAC,GAAG,IAAI,IAAI,CAAC,WAAW,EAAE;AAC9B,gBAAI,CAAC,MAAM,CAAC,MAAM,IAAI,eAAe,CAAC;AACtC,gBAAI,CAAC,eAAe,GAAG,IAAI,GAAG,CAAC,0BAA0B,CAAC,IAAI,CAAC,GAAG,EAAE,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;AAC9F,cAAE,CAAC,YAAY,CAAC,WAAW,CAAC,IAAI,CAAC,eAAe,EAAE,CAAC,CAAC,CAAC;;AAErD,gBAAI,CAAC,UAAU,GAAG,CAAC,CAAC;AACpB,gBAAI,CAAC,GAAG,CAAC,MAAM,EAAE,CAAC;SACrB;KACJ;;;AAGD,UAAM,EAAE,kBAAY;;AAEhB,YAAI,CAAC,EAAE,CAAC,GAAG,CAAC,QAAQ,EAAE;AAClB,mBAAO;SACV;AACD,YAAI,CAAC,MAAM,CAAC,MAAM,IAAI,aAAa,CAAC;AACpC,YAAI,WAAW,GAAI,CAAC,GAAG,CAAC,SAAS,GAAG,GAAG,CAAC,SAAS,CAAC,eAAe,EAAE,GAAG,GAAG,CAAA,GAAI,qBAAqB,AAAC,CAAC;;AAEpG,UAAE,CAAC,GAAG,CAAC,kCAAkC,GAAG,WAAW,CAAC,CAAC;AACzD,YAAI,CAAC,MAAM,CAAC,MAAM,IAAI,WAAW,GAAG,IAAI,CAAC;AACzC,UAAE,CAAC,GAAG,CAAC,uBAAuB,GAAG,IAAI,CAAC,WAAW,CAAC,CAAC;AACnD,YAAI,CAAC,GAAG,GAAG,IAAI,GAAG,CAAC,aAAa,CAAC,IAAI,CAAC,WAAW,EAAE,WAAW,CAAC,CAAC;AAChE,YAAI,CAAC,GAAG,CAAC,MAAM,EAAE,CAAC;;AAElB,YAAI,CAAC,WAAW,GAAG,KAAK,CAAC;AACzB,YAAI,IAAI,CAAC,GAAG,CAAC,gBAAgB,EAAE,CAAC,QAAQ,EAAE,EAC1C;AACI,gBAAI,CAAC,cAAc,GAAG,IAAI,GAAG,CAAC,0BAA0B,CAAC,IAAI,CAAC,GAAG,EAAE,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;AAC5F,cAAE,CAAC,YAAY,CAAC,WAAW,CAAC,IAAI,CAAC,cAAc,EAAE,CAAC,CAAC,CAAC;;AAEpD,gBAAI,CAAC,GAAG,CAAC,WAAW,EAAE,CAAC;SAC1B;KACJ;;AAED,aAAS,EAAE,qBAAY;;KAEtB;CACJ,CAAC,CAAC",
  "file": "unknown",
  "sourcesContent": [
    "cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        updatePanel: {\n            default: null,\n            type: cc.Node\n        },\n        manifestUrl: {\n            default: null,\n            url: cc.RawAsset\n        },\n        percent: {\n            default: null,\n            type: cc.Label\n        },\n        lblErr: {\n            default: null,\n            type: cc.Label\n        }\n    },\n\n    checkCb: function (event) {\n        cc.log('Code: ' + event.getEventCode());\n        switch (event.getEventCode())\n        {\n            case jsb.EventAssetsManager.ERROR_NO_LOCAL_MANIFEST:\n                cc.log(\"No local manifest file found, hot update skipped.\");\n                // cc.eventManager.removeListener(this._checkListener);\n                break;\n            case jsb.EventAssetsManager.ERROR_DOWNLOAD_MANIFEST:\n            case jsb.EventAssetsManager.ERROR_PARSE_MANIFEST:\n                cc.log(\"Fail to download manifest file, hot update skipped.\");\n                // cc.eventManager.removeListener(this._checkListener);\n                break;\n            case jsb.EventAssetsManager.ALREADY_UP_TO_DATE:\n                cc.log(\"Already up to date with the latest remote version.\");\n                // cc.eventManager.removeListener(this._checkListener);\n                this.lblErr.string += \"游戏不需要更新\\n\";\n                cc.director.loadScene(\"loading\");\n                break;\n            case jsb.EventAssetsManager.NEW_VERSION_FOUND:\n                this._needUpdate = true;\n                this.updatePanel.active = true;\n                this.percent.string = '00.00%';\n                // cc.eventManager.removeListener(this._checkListener);\n                break;\n            default:\n                break;\n        }\n        this.hotUpdate();\n    },\n\n    updateCb: function (event) {\n        var needRestart = false;\n        var failed = false;\n        var code = event.getEventCode()\n        this.lblErr.string = 'CODE is ' +code+'\\n';\n        switch (code)\n        {\n            case jsb.EventAssetsManager.ERROR_NO_LOCAL_MANIFEST:{\n                cc.log('No local manifest file found, hot update skipped.');\n                this.lblErr.string += 'No local manifest file found, hot update skipped.\\n';\n                failed = true;\n                break;\n              }\n            case jsb.EventAssetsManager.UPDATE_PROGRESSION:{\n                var percent = event.getPercent();\n                var percentByFile = event.getPercentByFile();\n\n                var msg = event.getMessage();\n                if (msg) {\n                    cc.log(msg);\n                }\n                cc.log(percent.toFixed(2) + '%');\n                this.percent.string = percent + '%';\n                break;\n              }\n            case jsb.EventAssetsManager.ERROR_DOWNLOAD_MANIFEST:{\n              this.lblErr.string += 'ERROR_DOWNLOAD_MANIFEST\\n';}\n            case jsb.EventAssetsManager.ERROR_PARSE_MANIFEST:{\n                cc.log('Fail to download manifest file, hot update skipped.');\n                this.lblErr.string += 'Fail to download manifest file, hot update skipped.\\n';\n                failed = true;\n                break;}\n            case jsb.EventAssetsManager.ALREADY_UP_TO_DATE:{\n                cc.log('Already up to date with the latest remote version.');\n                this.lblErr.string += 'Already up to date with the latest remote version.\\n';\n                failed = true;\n                break;}\n            case jsb.EventAssetsManager.UPDATE_FINISHED:{\n                cc.log('Update finished. ' + event.getMessage());\n                this.lblErr.string += 'Update finished. ' + event.getMessage() + '\\n';\n                needRestart = true;\n                break;}\n            case jsb.EventAssetsManager.UPDATE_FAILED:{\n                cc.log('Update failed. ' + event.getMessage());\n                 this.lblErr.string += 'Update failed. ' + event.getMessage()  + '\\n';\n                this._failCount ++;\n                if (this._failCount < 5)\n                {\n                    this._am.downloadFailedAssets();\n                }\n                else\n                {\n                    cc.log('Reach maximum fail count, exit update process');\n                     this.lblErr.string += 'Reach maximum fail count, exit update process\\n';\n                    this._failCount = 0;\n                    failed = true;\n                }\n                break;}\n            case jsb.EventAssetsManager.ERROR_UPDATING:{\n                cc.log('Asset update error: ' + event.getAssetId() + ', ' + event.getMessage());\n                this.lblErr.string += 'Asset update error: ' + event.getAssetId() + ', ' + event.getMessage() + '\\n';\n                break;}\n            case jsb.EventAssetsManager.ERROR_DECOMPRESS:{\n                cc.log(event.getMessage());\n                this.lblErr.string += event.getMessage() + 'ERROR_DECOMPRESS\\n';\n                break;}\n            default:{\n\n                break;}\n        }\n        //this.lblErr.string += 'failed is '+ failed + \"and needRestart is \" + needRestart;\n        if (failed) {\n            // cc.eventManager.removeListener(this._updateListener);\n            this.updatePanel.active = false;\n        }\n\n        if (needRestart) {\n            // cc.eventManager.removeListener(this._updateListener);\n            // Prepend the manifest's search path\n            var searchPaths = jsb.fileUtils.getSearchPaths();\n            var newPaths = this._am.getLocalManifest().getSearchPaths();\n            Array.prototype.unshift(searchPaths, newPaths);\n            // This value will be retrieved and appended to the default search path during game startup,\n            // please refer to samples/js-tests/main.js for detailed usage.\n            // !!! Re-add the search paths in main.js is very important, otherwise, new scripts won't take effect.\n            cc.sys.localStorage.setItem('HotUpdateSearchPaths', JSON.stringify(searchPaths));\n\n            jsb.fileUtils.setSearchPaths(searchPaths);\n            this.lblErr.string += \"游戏资源更新完毕\\n\";\n            cc.game.restart();\n        }\n    },\n\n    hotUpdate: function () {\n        if (this._am && this._needUpdate) {\n            this.lblErr.string += \"开始更新游戏资源...\\n\";\n            this._updateListener = new jsb.EventListenerAssetsManager(this._am, this.updateCb.bind(this));\n            cc.eventManager.addListener(this._updateListener, 1);\n\n            this._failCount = 0;\n            this._am.update();\n        }\n    },\n\n    // use this for initialization\n    onLoad: function () {\n        // Hot update is only available in Native build\n        if (!cc.sys.isNative) {\n            return;\n        }\n        this.lblErr.string += \"检查游戏资源...\\n\";\n        var storagePath = ((jsb.fileUtils ? jsb.fileUtils.getWritablePath() : '/') + 'tiantianqipai-asset');\n        // var storagePath = ((jsb.fileUtils ? jsb.fileUtils.getWritablePath() : './'));\n        cc.log('Storage path for remote asset : ' + storagePath);\n        this.lblErr.string += storagePath + \"\\n\";\n        cc.log('Local manifest URL : ' + this.manifestUrl);\n        this._am = new jsb.AssetsManager(this.manifestUrl, storagePath);\n        this._am.retain();\n\n        this._needUpdate = false;\n        if (this._am.getLocalManifest().isLoaded())\n        {\n            this._checkListener = new jsb.EventListenerAssetsManager(this._am, this.checkCb.bind(this));\n            cc.eventManager.addListener(this._checkListener, 1);\n\n            this._am.checkUpdate();\n        }\n    },\n\n    onDestroy: function () {\n        // this._am && this._am.release();\n    }\n});\n"
  ]
}