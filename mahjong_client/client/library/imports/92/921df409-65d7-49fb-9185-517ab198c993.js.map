{"version":3,"sources":["assets/scripts/components/MJRoom.js"],"names":["cc","Class","extends","Component","properties","lblRoomNo","default","type","Label","_seats","_seats2","_timeLabel","_voiceMsgQueue","_lastPlayingSeat","_playingSeat","_lastPlayTime","_ifshowipwarning","onLoad","vv","initView","initSeats","initEventHandlers","youkeorweixin","sys","localStorage","getItem","os","OS_IOS","find","active","prepare","node","getChildByName","seats","i","children","length","push","getComponent","refreshBtns","string","gameNetMgr","getWanfa","roomId","gameChild","sides","sideNode","seat","btnWechat","utils","addClickEvent","btnCopy","titles","conf","btnExit","btnDispress","btnWeichat","btnBack","isIdle","numOfGames","console","log","isOwner","ipWarning","nowseat","seatIndex","others","name","ip","warnames","str","join","alert","show","net","send","self","on","data","initSingleSeat","detail","refreshXuanPaiState","idx","seatindex","localIdx","getLocalIndex","playVoice","getSeatIndexByID","sender","chat","content","index","info","getQuickChatInfo","audioMgr","playSFX","sound","emoji","isOffline","online","isZhuang","button","setInfo","score","setReady","ready","setOffline","setID","userid","voiceMsg","setZhuang","onBtnSettingsClicked","popupMgr","showSettings","onBtnBackClicked","director","loadScene","onBtnChatClicked","onBtnWeichatClicked","title","anysdkMgr","share","onBtnCopyClicked","copy","setTimeout","onBtnDissolveClicked","onBtnExit","shift","localIndex","msgInfo","JSON","parse","msgfile","msg","voiceMgr","writeVoice","play","Date","now","time","update","dt","minutes","Math","floor","_lastMinute","date","h","getHours","m","getMinutes","onPlayerOver","resumeAll","onDestroy","stop"],"mappings":"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","file":"unknown","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        lblRoomNo:{\n            default:null,\n            type:cc.Label\n        },\n        _seats:[],\n        _seats2:[],\n        _timeLabel:null,\n        _voiceMsgQueue:[],\n        _lastPlayingSeat:null,\n        _playingSeat:null,\n        _lastPlayTime:null,\n        _ifshowipwarning:true,\n    },\n\n    // use this for initialization\n    onLoad: function () {\n        if(cc.vv == null){\n            return;\n        }\n        \n        this.initView();\n        this.initSeats();\n        this.initEventHandlers();\n        \n        var youkeorweixin = cc.sys.localStorage.getItem(\"youkeorweixin\");\n        if(cc.sys.os == cc.sys.OS_IOS && youkeorweixin == \"0\"){\n            //隐藏显示下边按钮\n            cc.find(\"Canvas/prepare/btnWeichat\").active = false;\n        }\n        //this.addComponent(\"Alert\");\n    },\n    \n    initView:function(){\n        var prepare = this.node.getChildByName(\"prepare\");\n        var seats = prepare.getChildByName(\"seats\");\n        for(var i = 0; i < seats.children.length; ++i){\n            this._seats.push(seats.children[i].getComponent(\"Seat\"));\n        }\n        \n        this.refreshBtns();\n        \n        this.lblRoomNo = cc.find(\"Canvas/infobar/shijian/Z_room_txt/New Label\").getComponent(cc.Label);\n        this._timeLabel = cc.find(\"Canvas/infobar/shijian/time\").getComponent(cc.Label);\n        \n        //显示玩法\n        cc.find(\"Canvas/infobar/wanfa\").getComponent(cc.Label).string =  cc.vv.gameNetMgr.getWanfa();\n        \n        \n        this.lblRoomNo.string = cc.vv.gameNetMgr.roomId;\n        var gameChild = this.node.getChildByName(\"game\");\n        var sides = [\"myself\",\"right\",\"up\",\"left\"];\n        for(var i = 0; i < sides.length; ++i){\n            var sideNode = gameChild.getChildByName(sides[i]);\n            var seat = sideNode.getChildByName(\"seat\");\n            this._seats2.push(seat.getComponent(\"Seat\"));\n        }\n        \n        var btnWechat = cc.find(\"Canvas/prepare/btnWeichat\");\n        if(btnWechat){\n            cc.vv.utils.addClickEvent(btnWechat,this.node,\"MJRoom\",\"onBtnWeichatClicked\");\n        }\n        \n        var btnCopy = cc.find(\"Canvas/prepare/btnCopy\");\n        if(btnCopy){\n            cc.vv.utils.addClickEvent(btnCopy,this.node,\"MJRoom\",\"onBtnCopyClicked\");\n        }\n        \n        \n        var titles = cc.find(\"Canvas/typeTitle\");\n        for(var i = 0; i < titles.children.length; ++i){\n            titles.children[i].active = false;\n        }\n        \n        if(cc.vv.gameNetMgr.conf){\n            // var type = cc.vv.gameNetMgr.conf.type;\n            // if(type == null || type == \"\"){\n            //     type = \"xzdd\";\n            // }\n            // titles.getChildByName(type).active = true;   \n        }\n    },\n    \n    refreshBtns:function(){\n        var prepare = this.node.getChildByName(\"prepare\");\n        var btnExit = prepare.getChildByName(\"btnExit\");\n        var btnDispress = prepare.getChildByName(\"btnDissolve\");\n        var btnWeichat = prepare.getChildByName(\"btnWeichat\");\n        var btnBack = prepare.getChildByName(\"btnBack\");\n        var isIdle = cc.vv.gameNetMgr.numOfGames == 0;\n        console.log('isIdle'+isIdle);\n        console.log(cc.vv.gameNetMgr.numOfGames);\n        btnExit.active = !cc.vv.gameNetMgr.isOwner() && isIdle;\n        btnDispress.active = cc.vv.gameNetMgr.isOwner() && isIdle;\n        \n        btnWeichat.active = isIdle;\n        btnBack.active = isIdle;\n    },\n    \n    ipWarning:function(){\n        \n        if(!this._ifshowipwarning) return;\n        \n        var seats = cc.vv.gameNetMgr.seats;\n        var nowseat = cc.vv.gameNetMgr.seatIndex;\n        if(!nowseat) return;\n        var others = [];\n        for(var i = 0 ; i < 4 ; i ++) {\n            if(nowseat && i!=nowseat) {\n                others.push([seats[i].name,seats[i].ip]);\n            }\n        }\n        var warnames = [];\n        if ( (others[0][1] == others [1][1] || others[0][1] == others [2][1]) && others[0][1]!=null) {\n            warnames.push(others[0][0]);\n        }\n        if ( (others[1][1] == others [0][1] || others[1][1] == others [2][1]) && others[1][1]!=null) {\n            warnames.push(others[1][0]);\n        }\n        if ( (others[2][1] == others [1][1] || others[2][1] == others [0][1]) && others[1][1]!=null) {\n            warnames.push(others[2][0]);\n        }\n        var str = warnames.join(\"、\");\n        if(warnames.length > 0 ){\n            cc.vv.alert.show(\"IP警告\",\"玩家\" + str + \"来自相同IP，请谨防其他玩家打勾手上当受骗\",function(){\n                  cc.vv.net.send(\"dissolve_cause_ip\");\n            },true,\"解散\",\"继续\");\n            this._ifshowipwarning = false;\n        }\n        \n    },\n    \n    initEventHandlers:function(){\n        var self = this;\n        this.node.on('new_user',function(data){\n            self.initSingleSeat(data.detail);\n        });\n        \n        this.node.on('user_state_changed',function(data){\n            self.initSingleSeat(data.detail);\n        });\n        \n        this.node.on('game_begin',function(data){\n            \n            self.refreshBtns();\n            self.initSeats();\n        });\n        \n        this.node.on('game_num',function(data){\n            \n            self.refreshBtns();\n        });\n\n        this.node.on('game_huanpai',function(data){\n            for(var i in self._seats2){\n                self._seats2[i].refreshXuanPaiState();    \n            }\n        });\n                \n        this.node.on('huanpai_notify',function(data){\n            var idx = data.detail.seatindex;\n            var localIdx = cc.vv.gameNetMgr.getLocalIndex(idx);\n            self._seats2[localIdx].refreshXuanPaiState();\n        });\n        \n        this.node.on('game_huanpai_over',function(data){\n            for(var i in self._seats2){\n                self._seats2[i].refreshXuanPaiState();    \n            }\n        });\n        \n        this.node.on('voice_msg',function(data){\n            var data = data.detail;\n            self._voiceMsgQueue.push(data);\n            self.playVoice();\n        });\n        \n        this.node.on('chat_push',function(data){\n            var data = data.detail;\n            var idx = cc.vv.gameNetMgr.getSeatIndexByID(data.sender);\n            var localIdx = cc.vv.gameNetMgr.getLocalIndex(idx);\n            self._seats[localIdx].chat(data.content);\n            self._seats2[localIdx].chat(data.content);\n        });\n        \n        this.node.on('quick_chat_push',function(data){\n            var data = data.detail;\n            var idx = cc.vv.gameNetMgr.getSeatIndexByID(data.sender);\n            var localIdx = cc.vv.gameNetMgr.getLocalIndex(idx);\n            \n            var index = data.content;\n            var info = cc.vv.chat.getQuickChatInfo(index);\n            self._seats[localIdx].chat(info.content);\n            self._seats2[localIdx].chat(info.content);\n            \n            cc.vv.audioMgr.playSFX(info.sound);\n        });\n        \n        this.node.on('emoji_push',function(data){\n            var data = data.detail;\n            var idx = cc.vv.gameNetMgr.getSeatIndexByID(data.sender);\n            var localIdx = cc.vv.gameNetMgr.getLocalIndex(idx);\n            console.log(data);\n            self._seats[localIdx].emoji(data.content);\n            self._seats2[localIdx].emoji(data.content);\n        });\n    },\n    \n    initSeats:function(){\n        var seats = cc.vv.gameNetMgr.seats;\n        for(var i = 0; i < seats.length; ++i){\n            this.initSingleSeat(seats[i]);\n        }\n    },\n    \n    initSingleSeat:function(seat){\n        var index = cc.vv.gameNetMgr.getLocalIndex(seat.seatindex);\n        var isOffline = !seat.online;\n        var isZhuang = seat.seatindex == cc.vv.gameNetMgr.button;\n        \n        console.log(\"isOffline:\" + isOffline);\n        \n        this._seats[index].setInfo(seat.name,seat.score);\n        this._seats[index].setReady(seat.ready);\n        this._seats[index].setOffline(isOffline);\n        this._seats[index].setID(seat.userid);\n        this._seats[index].voiceMsg(false);\n        \n        this._seats2[index].setInfo(seat.name,seat.score);\n        this._seats2[index].setZhuang(isZhuang);\n        this._seats2[index].setOffline(isOffline);\n        this._seats2[index].setID(seat.userid);\n        this._seats2[index].voiceMsg(false);\n        this._seats2[index].refreshXuanPaiState();\n    },\n    \n    onBtnSettingsClicked:function(){\n        cc.vv.popupMgr.showSettings();   \n    },\n\n    onBtnBackClicked:function(){\n        cc.vv.alert.show(\"返回大厅\",\"返回大厅房间仍会保留，快去邀请大伙来玩吧！\",function(){\n            cc.director.loadScene(\"hall\");    \n        },true);\n    },\n    \n    onBtnChatClicked:function(){\n        \n    },\n    \n    onBtnWeichatClicked:function(){\n        if(cc.vv.gameNetMgr.conf.type == \"sjmmj\"){\n            var title = \"<沈家门麻将>\";\n        }\n        else if(cc.vv.gameNetMgr.conf.type == \"dhmj\"){\n            var title = \"<定海麻将>\";\n        }\n        else if(cc.vv.gameNetMgr.conf.type == \"tdh\"){\n            var title = \"<推倒胡>\";\n        }\n        cc.vv.anysdkMgr.share(\"奇奇舟山麻将\" + title,\"房号:\" + cc.vv.gameNetMgr.roomId + \" 玩法:\" + cc.vv.gameNetMgr.getWanfa());\n    },\n    \n    //复制房间信息\n    onBtnCopyClicked:function() {\n        if(cc.vv.gameNetMgr.conf.type == \"sjmmj\"){\n            var title = \"<沈家门麻将>\";\n        }\n        else if(cc.vv.gameNetMgr.conf.type == \"dhmj\"){\n            var title = \"<定海麻将>\";\n        }\n        else if(cc.vv.gameNetMgr.conf.type == \"tdh\"){\n            var title = \"<推倒胡>\";\n        }\n        cc.vv.anysdkMgr.copy(\"奇奇舟山麻将\" + title + \" 房号:【\" + cc.vv.gameNetMgr.roomId+\"】 玩法:\" + cc.vv.gameNetMgr.getWanfa());\n        cc.find(\"Canvas/copysuccess\").active = true;\n        setTimeout(function() {cc.find(\"Canvas/copysuccess\").active = false;}, 1000);\n        \n    },\n    \n    onBtnDissolveClicked:function(){\n        var youkeorweixin = cc.sys.localStorage.getItem(\"youkeorweixin\");\n        if(cc.sys.os == cc.sys.OS_IOS && youkeorweixin == \"0\"){\n            cc.vv.alert.show(\"解散房间\",\"是否确定解散？\",function(){\n                cc.vv.net.send(\"dispress\");    \n            },true);\n            return;\n        }\n        \n        \n        cc.vv.alert.show(\"解散房间\",\"解散房间不扣房卡，是否确定解散？\",function(){\n            cc.vv.net.send(\"dispress\");    \n        },true);\n    },\n    \n    onBtnExit:function(){\n        cc.vv.net.send(\"exit\");\n    },\n    \n    playVoice:function(){\n        if(this._playingSeat == null && this._voiceMsgQueue.length){\n            console.log(\"playVoice2\");\n            var data = this._voiceMsgQueue.shift();\n            var idx = cc.vv.gameNetMgr.getSeatIndexByID(data.sender);\n            var localIndex = cc.vv.gameNetMgr.getLocalIndex(idx);\n            this._playingSeat = localIndex;\n            this._seats[localIndex].voiceMsg(true);\n            this._seats2[localIndex].voiceMsg(true);\n            \n            var msgInfo = JSON.parse(data.content);\n            \n            var msgfile = \"voicemsg.amr\";\n            console.log(msgInfo.msg.length);\n            cc.vv.voiceMgr.writeVoice(msgfile,msgInfo.msg);\n            cc.vv.voiceMgr.play(msgfile);\n            this._lastPlayTime = Date.now() + msgInfo.time;\n        }\n    },\n    \n    // called every frame, uncomment this function to activate update callback\n    update: function (dt) {\n        var minutes = Math.floor(Date.now()/1000/60);\n        if(this._lastMinute != minutes){\n            this._lastMinute = minutes;\n            var date = new Date();\n            var h = date.getHours();\n            h = h < 10? \"0\"+h:h;\n            \n            var m = date.getMinutes();\n            m = m < 10? \"0\"+m:m;\n            this._timeLabel.string = \"\" + h + \":\" + m;             \n        }\n        \n        \n        if(this._lastPlayTime != null){\n            if(Date.now() > this._lastPlayTime + 200){\n                this.onPlayerOver();\n                this._lastPlayTime = null;    \n            }\n        }\n        else{\n            this.playVoice();\n        }\n        this.ipWarning();\n    },\n    \n        \n    onPlayerOver:function(){\n        cc.vv.audioMgr.resumeAll();\n        console.log(\"onPlayCallback:\" + this._playingSeat);\n        var localIndex = this._playingSeat;\n        this._playingSeat = null;\n        this._seats[localIndex].voiceMsg(false);\n        this._seats2[localIndex].voiceMsg(false);\n    },\n    \n    onDestroy:function(){\n        cc.vv.voiceMgr.stop();\n//        cc.vv.voiceMgr.onPlayCallback = null;\n    }\n});\n"]}